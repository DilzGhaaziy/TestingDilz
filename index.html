<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <title>IF25 Terkece Biodata</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Berkshire+Swash&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
/* --- 1. SETTING DASAR & WARNA --- */
        :root {
            --bg-gradient: transparent; 
            --text-color: #333;
            --card-bg: rgba(230, 230, 254, 0.85);
            --nim-bg: #ecf0f1;
            --nim-text: #2c3e50;
            --fixed-bg: rgba(255, 255, 255, 0.85);
            --fixed-text: #2c3e50;
            --firefly-color: #ffeb3b; 
            --glow-color: rgba(52, 152, 219, 0.3); 
        }

        body.dark-mode {
            --text-color: #e0e0e0;
            --card-bg: rgba(43, 63, 118, 0.85); 
            --nim-bg: #1a1a2e;
            --nim-text: #bdc3c7;
            --fixed-bg: rgba(15, 52, 96, 0.85);
            --fixed-text: #e0e0e0;
            --firefly-color: #76ff03;
            --glow-color: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            min-height: 100vh; 
            overflow-x: hidden; 
            position: relative;
            background-color: #f0f0f0; 
            -webkit-overflow-scrolling: touch; 
            overscroll-behavior-y: none; 
        }

/* =========================================
   BACKGROUND SYSTEMS (Optimized)
   ========================================= */
        .global-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -9999;
            overflow: hidden;
            pointer-events: none;
            transform: translateZ(0);
        }

        #bg-light-mode {
            background-color: #000510;
            background-image: linear-gradient(135deg, #001233 0%, #003060 100%);
            display: block;
        }
        
        body.dark-mode #bg-light-mode { display: none; }

        /* --- 1. CAHAYA AURORA (GLOW) --- */
        .glow {
            position: absolute; 
            border-radius: 50%;
            filter: blur(60px); 
            mix-blend-mode: screen; 
            will-change: transform; 
            opacity: 0.6;
            transform: translateZ(0); 
        }

        .glow-1 {
            width: 80vw; height: 80vh; 
            background: linear-gradient(45deg, #00fff2, #00a2ff);
            bottom: -20%; left: -20%; 
            animation: drift 12s infinite alternate ease-in-out;
        }

        .glow-2 {
            width: 90vw; height: 70vh; 
            background: linear-gradient(120deg, #0061ff, #001eff);
            top: -10%; right: -10%; 
            opacity: 0.5;
            animation: drift 15s infinite alternate-reverse ease-in-out;
        }

        .glow-3 {
            width: 100vw; height: 40vh;
            background: radial-gradient(ellipse at center, rgba(0, 255, 234, 0.4), transparent 70%);
            top: 30%; left: 10%; 
            transform: rotate(-45deg) scaleY(0.5);
            filter: blur(50px); 
            opacity: 0.4;
        }

        /* --- 2. BINTANG BERGERAK (STARS) --- */
        .stars-bg, .stars-sm-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            will-change: transform;
            z-index: -1; 
        }

        .stars-bg {
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #ffffff, rgba(0,0,0,0)), 
                radial-gradient(2px 2px at 40px 70px, #ffffff, rgba(0,0,0,0)), 
                radial-gradient(2px 2px at 50px 160px, #ffffff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 90px 40px, #ffffff, rgba(0,0,0,0)),
                radial-gradient(1.5px 1.5px at 130px 80px, #ffffff, rgba(0,0,0,0));
            background-size: 200px 200px; 
            opacity: 0.8;
            animation: moveUpSmall 50s linear infinite; 
        }

        .stars-sm-bg {
            background-image: 
                radial-gradient(1px 1px at 10px 10px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 150px 150px, #fff, rgba(0,0,0,0));
            background-size: 100px 100px;
            opacity: 0.5;
            animation: moveUpSmall 80s linear infinite; 
        }

        @keyframes drift {
            0% { transform: translate3d(0, 0, 0) rotate(20deg) skewX(-20deg); }
            100% { transform: translate3d(20px, -20px, 0) rotate(25deg) skewX(-15deg); }
        }

        @keyframes moveUpSmall { 
            from { transform: translateY(0); } 
            to { transform: translateY(-1000px); } 
        }

        /* --- DARK MODE BACKGROUND --- */
        #bg-dark-mode {
            background: radial-gradient(ellipse at bottom, #0B1026 0%, #000000 100%);
            display: none;
            perspective: 1000px;
        }
        body.dark-mode #bg-dark-mode { display: block; }

        .star-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: transparent; will-change: transform;
        }
        .star-field {
            width: 2px; height: 2px; background: transparent; border-radius: 50%;
        }
        @keyframes moveStars {
            from { transform: translateY(0); }
            to { transform: translateY(-2000px); }
        }
        .layer-1 { animation: moveStars 100s linear infinite; opacity: 0.6; }
        .layer-2 { animation: moveStars 50s linear infinite; opacity: 0.8; }
        .layer-3 { animation: moveStars 25s linear infinite; opacity: 1; }

        .meteor {
            position: absolute; opacity: 0; transform-origin: left center;
            pointer-events: none; z-index: 10;
            background: linear-gradient(90deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%);
            border-radius: 500px; will-change: transform, opacity;
        }
        .meteor-head {
            position: absolute; left: 0; top: 50%; transform: translate(-50%, -50%);
            border-radius: 50%; background: #fff;
            box-shadow: 0 0 10px 2px rgba(100, 200, 255, 0.8);
        }
        @keyframes shooting {
            0% { transform: translate3d(0, 0, 0) rotate(-45deg); opacity: 1; }
            100% { transform: translate3d(-150vh, 150vh, 0) rotate(-45deg); opacity: 0; }
        }

/* =========================================
   LAYOUT UTAMA
   ========================================= */
        #profile-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; 
            display: none; opacity: 0;
            transition: opacity 0.3s ease; overflow-y: auto; 
            background: transparent !important; 
            will-change: opacity;
        }

        .profile-content { 
            position: relative; z-index: 5; 
            width: 100%; min-height: 100%; 
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            padding: 40px 20px; 
        }

        .fixed-element {
            position: fixed; top: 20px; z-index: 1000;
            background: var(--fixed-bg); padding: 10px 20px;
            border-radius: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transform: translateZ(0); 
            will-change: transform;
            color: var(--fixed-text);
            display: flex; align-items: center; justify-content: center;
            text-decoration: none; font-size: 14px; font-weight: 600;
            transition: transform 0.2s; border: 1px solid rgba(255,255,255,0.1);
        }
        .pos-left { left: 20px; }
        .pos-right { right: 20px; } 
        .pos-theme { right: 180px; width: 45px; height: 45px; padding: 0; cursor: pointer; border: none; font-size: 18px; }
        .pos-right i { color: #ff0000; font-size: 18px; margin-right: 8px; }
        .pos-theme i { color: #f1c40f; }
        body.dark-mode .pos-theme i { color: #f39c12; }

        /* Event Box */
        .event-box {
            position: fixed; top: 70px; left: 20px; z-index: 999;
            background: linear-gradient(135deg, #ffd700 0%, #2ecc71 100%);
            padding: 8px 20px; border-radius: 30px;
            color: #fff; font-size: 13px; font-weight: 700;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
            cursor: pointer; overflow: hidden; transition: transform 0.2s;
            border: 2px solid rgba(255,255,255,0.3);
            display: flex; align-items: center; gap: 8px;
        }
        .event-box:hover { transform: scale(1.05); }

        /* Now Playing */
        .now-playing-box {
            position: fixed; bottom: 20px; right: 0; z-index: 9999;
            background: var(--fixed-bg);
            backdrop-filter: blur(10px);
            transform: translate3d(calc(100% - 50px), 0, 0); 
            will-change: transform;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px; padding-right: 20px;
            border-top-left-radius: 50px; border-bottom-left-radius: 50px;
            box-shadow: -5px 5px 20px rgba(0,0,0,0.2);
            display: flex; align-items: center; gap: 15px;
            width: 300px; 
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .now-playing-box.expanded { 
            transform: translate3d(0, 0, 0); 
        }
        .np-icon {
            width: 35px; height: 35px; flex-shrink: 0;
            background: #e91e63; color: white; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; animation: spin 3s linear infinite;
            cursor: pointer; position: relative; z-index: 2;
        }
        .now-playing-box:not(.expanded) .np-icon { animation: spin 3s linear infinite, pulseIcon 2s infinite; }
        @keyframes pulseIcon { 0% { box-shadow: 0 0 0 0 rgba(233, 30, 99, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(233, 30, 99, 0); } 100% { box-shadow: 0 0 0 0 rgba(233, 30, 99, 0); } }
        .np-content { display: flex; align-items: center; justify-content: space-between; width: 100%; overflow: hidden; opacity: 0; transition: opacity 0.2s; }
        .now-playing-box.expanded .np-content { opacity: 1; transition-delay: 0.2s; }
        .np-info { display: flex; flex-direction: column; overflow: hidden; max-width: 140px; }
        .np-label { font-size: 9px; color: var(--text-color); opacity: 0.7; text-transform: uppercase; letter-spacing: 1px; }
        .np-title { font-size: 12px; font-weight: 700; color: var(--fixed-text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .np-controls { display: flex; gap: 8px; }
        .np-btn {
            background: rgba(0,0,0,0.05); border: none; color: var(--fixed-text);
            width: 28px; height: 28px; border-radius: 50%;
            cursor: pointer; font-size: 12px; transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .np-btn:hover { background: #e91e63; color: white; }
        .np-btn.active-list { background: #3498db; color: white; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Playlist */
        .playlist-box {
            position: fixed; bottom: 80px; right: 20px;
            width: 280px; max-height: 400px;
            background: var(--card-bg); border-radius: 15px; z-index: 9998;
            padding: 3px; opacity: 0; visibility: hidden; transform: translateY(20px);
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
        }
        .playlist-box.show { opacity: 1; visibility: visible; transform: translateY(0); }
        .playlist-box::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: conic-gradient(transparent, transparent, transparent, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
            animation: rotateRGB 4s linear infinite; z-index: 0;
        }
        @keyframes rotateRGB { 100% { transform: rotate(360deg); } }
        .playlist-inner { position: relative; z-index: 1; background: var(--card-bg); width: 100%; height: 100%; border-radius: 12px; display: flex; flex-direction: column; }
        .playlist-header { padding: 12px 15px; font-weight: bold; border-bottom: 1px solid rgba(128,128,128,0.2); color: var(--text-color); display: flex; justify-content: space-between; align-items: center; }
        .playlist-scroll { padding: 10px; overflow-y: auto; max-height: 300px; }
        .track-item { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 8px; cursor: pointer; transition: 0.2s; margin-bottom: 5px; }
        .track-item:hover { background: rgba(0,0,0,0.05); }
        .track-item.playing { background: rgba(52, 152, 219, 0.15); border-left: 3px solid #3498db; }
        .track-icon { font-size: 12px; color: #7f8c8d; width: 20px; text-align: center; }
        .track-item.playing .track-icon { color: #3498db; animation: pulse 1s infinite; }
        .track-info { display: flex; flex-direction: column; flex: 1; overflow: hidden; }
        .track-name { font-size: 12px; font-weight: 600; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .track-status { font-size: 10px; color: #aaa; }

        /* Mobile Layout */
        .mobile-layout-controls {
            display: none; position: fixed; top: 75px; left: 50%; transform: translateX(-50%);
            z-index: 990; background: var(--fixed-bg); padding: 4px; border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .mobile-btn {
            background: transparent; border: none; color: var(--fixed-text);
            padding: 6px 15px; border-radius: 20px; cursor: pointer;
            font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 5px; transition: 0.3s;
        }
        .mobile-btn.active { background: #3498db; color: white; box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3); }

        /* Main View */
        #main-view { position: relative; z-index: 10; transition: opacity 0.5s; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px 40px 20px; padding-top: 120px; }
        header { text-align: center; margin-bottom: 30px; }
        h1 { 
            font-family: 'Berkshire Swash', cursive; font-weight: 400; color: #ff0000; margin-bottom: 5px; 
            font-size: 3rem; letter-spacing: 2px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        p.subtitle { color: #ddd; margin-bottom: 25px; }
        .search-box { width: 100%; max-width: 500px; margin: 0 auto 30px auto; }
        .search-box input {
            width: 100%; padding: 15px 25px; border-radius: 50px; border: none;
            font-family: 'Poppins', sans-serif; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            background: var(--card-bg); color: var(--text-color);
        }
        
        /* Grid Container */
        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
            padding: 10px; 
        }
        
        /* CARD STYLING */
        .card {
            background: var(--card-bg); 
            border-radius: 15px; padding: 25px; text-align: center; 
            border-top: 5px solid transparent; cursor: pointer;
            position: relative; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); 
            will-change: transform; 
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        @media (hover: hover) {
            .card::after {
                content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
                background: radial-gradient(600px circle at var(--x) var(--y), var(--glow-color), transparent 40%);
                opacity: 0; transition: opacity 0.3s ease; pointer-events: none; z-index: 2; 
            }
            .card:hover::after { opacity: 1; }
        }

        .card:hover { transform: translateY(-5px); border-top: 5px solid #3498db; box-shadow: 0 8px 20px rgba(0,0,0,0.15); z-index: 20; }
        .card.hidden-card { display: none; } 

        @keyframes ownerGlowLoop { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .card.owner-card {
            background: linear-gradient(45deg, #059669, #10b981, #de7ed4cc, #e598ffcc, #10b981, #059669);
            background-size: 400% 400%; animation: ownerGlowLoop 8s ease infinite; 
            color: white !important; border: 2px solid #ffd700; text-shadow: 0 1px 4px rgba(0,0,0,0.6); 
        }
        .card.owner-card .avatar, .card.owner-card h3, .card.owner-card .nim-badge { position: relative; z-index: 5; }
        .card.owner-card .owner-badge, .card.owner-card .gender-tag { z-index: 10; }

        /* Varian Card */
        .card.ketua-card { background: linear-gradient(135deg, #2980b9 0%, #6dd5fa 100%); color: white !important; border: 2px solid #fff; }
        .card.wakil1-card { background: linear-gradient(135deg, #6F2DA8 0%, #C54B8C 100%); color: white !important; border: 2px solid #ff758c; }
        .wakil1-badge { background: #fff; color: #8e44ad; }
        .card.wakil2-card { background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%); color: white !important; border: 2px solid #f39c12; }
        .wakil2-badge { background: #fff; color: #e67e22; }
        .card.keamanan-card { background: linear-gradient(135deg, #FF2400 0%, #7C0A02 150%); color: white !important; border: 2px solid #ff0000; }
        .keamanan-badge { background: #000; color: #ff0000; border: 1px solid #ff0000; }
        .card.pj-leni-card { background: linear-gradient(135deg, #FC6C85 0%, #FF46A2 100%); color: #444 !important; border: 2px solid #E89EB8; }
        .card.pj-leni-card h3, .card.pj-leni-card .nim-badge { color: #444 !important; }
        .card.pj-leni-card .nim-badge { background: rgba(255,255,255,0.25); }
        .pj-leni-badge { background: #ff6f91; color: white; }
        .card.pj-nirwanda-card { background: linear-gradient(135deg, #D30000 0%, #FF2400 80%); color: white !important; border: 2px solid #ff758c; }
        .pj-nirwanda-badge { background: #fff; color: #800020; }
        .card.wakil-if2-card { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white !important; border: 2px solid #fff; }
        .wakil-if2-badge { background: #fff; color: #00c6fb; }

        .card.owner-card h3, .card.ketua-card h3, .card.wakil-if2-card h3 { color: white !important; }
        .card.ketua-card h3 { text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .card.owner-card .nim-badge, .card.ketua-card .nim-badge, .card.wakil-if2-card .nim-badge { color: white; background: rgba(255,255,255,0.25); border: 1px solid rgba(255,255,255,0.2); }

        /* Badges */
        .owner-badge, .ketua-badge, .wakil-badge, .wakil1-badge, .wakil2-badge, .keamanan-badge, .pj-badge, .wakil-if2-badge {
            position: absolute; top: 10px; left: 10px; font-size: 10px; padding: 2px 8px; border-radius: 8px; font-weight: 800;
            box-shadow: 0 2px 3px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 4px; z-index: 10;
        }
        .owner-badge { background: #ffd700; color: #b45309; text-shadow: none; }
        .ketua-badge { background: #fff; color: #2980b9; }

        .gender-tag { position: absolute; top: 10px; right: 10px; font-size: 12px; padding: 2px 8px; border-radius: 10px; color: white; font-weight: bold; z-index: 10; }
        .gender-L { background: #3498db; }
        .gender-P { background: #e91e63; }
        
        .avatar {
            width: 65px; height: 65px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; margin: 0 auto 10px auto;
            position: relative; z-index: 5;
        }
        .card h3 { font-size: 17px; font-weight: 600; color: var(--text-color); min-height: 50px; display: flex; align-items: center; justify-content: center; position: relative; z-index: 5; }
        .nim-badge { background: var(--nim-bg); color: var(--nim-text); padding: 4px 12px; border-radius: 15px; font-size: 13px; font-weight: 500; position: relative; z-index: 5; }

        /* --- CSS PROFIL BIG CARD --- */
        .big-profile-card {
            background: var(--card-bg); border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 40px; border-radius: 30px; text-align: center; 
            color: var(--text-color); width: 100%; max-width: 500px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.1); 
            position: relative; overflow: hidden; animation: zoomIn 0.3s ease;
        }

        /* VARIAN WARNA PROFIL */
        .big-profile-card.owner-profile { background: linear-gradient(45deg, #059669, #10b981); color: white !important; border: 2px solid #ffd700; }
        .big-profile-card.ketua-profile { background: linear-gradient(135deg, #2980b9 0%, #6dd5fa 100%); color: white !important; }
        .big-profile-card.wakil1-profile { background: linear-gradient(135deg, #6F2DA8 0%, #C54B8C 100%); color: white !important; }
        .big-profile-card.wakil2-profile { background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%); color: white !important; }
        .big-profile-card.wakil-if2-profile { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white !important; }
        .big-profile-card.keamanan-profile { background: linear-gradient(135deg, #FF2400 0%, #7C0A02 150%); color: white !important; }
        
        .big-profile-card.pj-leni-profile { background: linear-gradient(135deg, #FC6C85 0%, #FF46A2 100%); color: #444 !important; }
        .big-profile-card.pj-leni-profile .info-label, .big-profile-card.pj-leni-profile .info-val, .big-profile-card.pj-leni-profile #p-nim { color: #444 !important; }

        .big-profile-card.pj-nirwanda-profile { background: linear-gradient(135deg, #D30000 0%, #FF2400 80%); color: white !important; }

        /* Override Text Color for Dark Background Profiles */
        .big-profile-card.owner-profile .info-label, .big-profile-card.owner-profile .info-val, .big-profile-card.owner-profile #p-nim,
        .big-profile-card.ketua-profile .info-label, .big-profile-card.ketua-profile .info-val, .big-profile-card.ketua-profile #p-nim,
        .big-profile-card.wakil1-profile .info-label, .big-profile-card.wakil1-profile .info-val, .big-profile-card.wakil1-profile #p-nim,
        .big-profile-card.wakil2-profile .info-label, .big-profile-card.wakil2-profile .info-val, .big-profile-card.wakil2-profile #p-nim,
        .big-profile-card.wakil-if2-profile .info-label, .big-profile-card.wakil-if2-profile .info-val, .big-profile-card.wakil-if2-profile #p-nim,
        .big-profile-card.keamanan-profile .info-label, .big-profile-card.keamanan-profile .info-val, .big-profile-card.keamanan-profile #p-nim,
        .big-profile-card.pj-nirwanda-profile .info-label, .big-profile-card.pj-nirwanda-profile .info-val, .big-profile-card.pj-nirwanda-profile #p-nim {
            color: #e0f2fe !important; text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .info-label { color: var(--text-color); opacity: 0.7; text-align: left; }
        .info-val { font-weight: 600; text-align: right; display: flex; align-items: center; gap: 8px; justify-content: flex-end; color: var(--fixed-text); }
        .quote-box { color: var(--text-color); border-left: 4px solid #f1c40f; background: rgba(0,0,0,0.05); }
        .big-profile-card #p-nim { color: var(--text-color); opacity: 0.8; }

        .owner-role {
            font-size: 12px; background: #ffd700; color: #b45309; padding: 2px 10px; border-radius: 10px;
            display: inline-block; font-weight: 800; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;
        }
        .owner-role.ketua-role-tag { background: #fff; color: #2980b9; }

        .big-avatar {
            width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 20px auto; background: linear-gradient(45deg, #ff00cc, #333399);
            display: flex; align-items: center; justify-content: center; font-size: 40px; font-weight: bold; border: 4px solid rgba(255,255,255,0.5);
            box-shadow: 0 0 30px rgba(255, 0, 204, 0.4);
        }
        .copy-btn { background: transparent; border: none; color: #bbb; cursor: pointer; margin-left: 8px; font-size: 14px; transition: 0.3s; }
        .copy-btn:hover { color: #fff; transform: scale(1.1); }
        .copy-tooltip { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; z-index: 5000; opacity: 0; pointer-events: none; transition: 0.3s; }
        .copy-tooltip.show { opacity: 1; margin-top: -50px; }
        
        .info-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 14px; }
        .info-row:last-child { border-bottom: none; }
        .edit-icon { cursor: pointer; color: #3498db; margin-left: 8px; font-size: 14px; transition: 0.3s; }
        .edit-icon.faded { color: #7f8c8d; opacity: 0.5; cursor: default; }

        .jodoh-btn { margin-top: 30px; width: 100%; padding: 15px; background: linear-gradient(90deg, #ff512f, #dd2476); border: none; border-radius: 50px; color: white; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 10px 20px rgba(221, 36, 118, 0.4); transition: transform 0.2s; position: relative; overflow: hidden; }
        .quote-box { margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 15px; font-size: 13px; font-style: italic; color: #ddd; border-left: 4px solid #f1c40f; text-align: center; }
        .ipk-btn { margin-top: 15px; width: 100%; padding: 12px; background: linear-gradient(135deg, #00b09b, #96c93d); border: none; border-radius: 50px; color: white; font-size: 15px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0, 176, 155, 0.4); transition: transform 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .ipk-btn:hover { transform: scale(1.02); }

        /* Modals */
        .modal-overlay, .date-picker-overlay, .date-confirm-overlay, .ipk-modal, .verify-modal, .event-modal, .ipk-input-modal, .event-challenge-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85);
            z-index: 5000; display: flex; align-items: center; justify-content: center; flex-direction: column;
            opacity: 0; visibility: hidden; transition: 0.3s; backdrop-filter: blur(5px);
        }
        .modal-overlay { z-index: 10000; } 
        .active { opacity: 1; visibility: visible; }
        
        .modal-box { background: var(--card-bg); padding: 40px; border-radius: 20px; text-align: center; max-width: 90%; width: 400px; transform: scale(0.9); transition: transform 0.3s; }
        .active .modal-box { transform: scale(1); }

        /* CSS MODAL IPK */
        .ipk-modal { overflow-y: auto; padding-top: 20px; padding-bottom: 20px; }
        .ipk-content {
            background: var(--card-bg); width: 90%; max-width: 400px; 
            border-radius: 20px; padding: 30px; position: relative; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2); 
            transform: translateY(20px); transition: 0.3s; margin: auto; 
        }
        .close-ipk {
            width: 100%; padding: 12px; background: #333; color: white; 
            border: none; border-radius: 15px; cursor: pointer; font-weight: bold; 
            transition: 0.2s; position: relative; z-index: 100; 
        }
        .close-ipk:hover { background: #555; }
        .ipk-modal.active .ipk-content { transform: translateY(0); }
        .ipk-header { text-align: center; margin-bottom: 20px; color: var(--text-color); }
        .semester-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px; }
        .semester-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: rgba(0,0,0,0.05); border-radius: 10px; font-size: 14px; font-weight: 500; color: var(--text-color); border-left: 4px solid #ccc; }
        .semester-row.has-score { border-left: 4px solid #00b09b; background: rgba(0, 176, 155, 0.1); }
        .ipk-edit-btn { background: none; border: none; color: #f39c12; cursor: pointer; margin-left: 10px; font-size: 14px; }
        
        .modern-input-field { width: 100%; padding: 15px; font-size: 24px; text-align: center; border: 2px solid #3498db; border-radius: 15px; background: white; color: #333; font-weight: bold; margin: 20px 0; outline: none; }
        .modern-input-field:focus { box-shadow: 0 0 15px rgba(52, 152, 219, 0.4); }

        .date-input-container { margin: 20px 0; display: flex; justify-content: center; }
        .custom-date-input { padding: 15px; border-radius: 10px; border: 2px solid #3498db; font-family: 'Poppins', sans-serif; font-size: 16px; width: 100%; color: #333; background: white; }
        .warning-text { color: #e74c3c; font-size: 13px; margin-bottom: 20px; font-weight: 600; }
        .confirm-btn-container { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .btn-check { width: 60px; height: 60px; border-radius: 50%; background: #2ecc71; color: white; border: none; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4); transition: transform 0.2s; }
        .btn-check:hover { transform: scale(1.1); }
        .btn-cross { width: 60px; height: 60px; border-radius: 50%; background: #e74c3c; color: white; border: none; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4); transition: transform 0.2s; }
        .btn-cross:hover { transform: scale(1.1); }
        .btn-conf-primary { background: #3498db; color: white; padding: 12px 25px; border-radius: 25px; border: none; font-weight: 600; cursor: pointer; font-size: 15px; }
        .btn-conf-close { background: #95a5a6; color: white; padding: 12px 25px; border-radius: 25px; border: none; font-weight: 600; cursor: pointer; font-size: 15px; }

        .verify-input { width: 100%; padding: 15px; text-align: center; font-size: 24px; letter-spacing: 5px; border: 2px solid #3498db; border-radius: 10px; margin-top: 20px; outline: none; background: white; color: #333; }
        .bold-ex { font-weight: 800; color: #e74c3c; }

        .event-list { text-align: left; margin-top: 20px; }
        .event-item { background: linear-gradient(135deg, #fceabb 0%, #f8b500 100%); padding: 15px; border-radius: 10px; color: #8e44ad; margin-bottom: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 2px solid #fff; animation: pulse 2s infinite; cursor: pointer; transition: transform 0.2s; }
        .event-item:active { transform: scale(0.95); }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(248, 181, 0, 0.7); } 70% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(248, 181, 0, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(248, 181, 0, 0); } }
        .event-title { font-weight: 800; font-size: 16px; margin-bottom: 5px; }
        .event-prize { font-size: 14px; font-weight: 600; color: #d35400; }

        .event-item.fire-theme {
            position: relative; background: #000; color: #fff; border: none; overflow: hidden; z-index: 1; box-shadow: 0 0 15px rgba(255, 69, 0, 0.5); animation: none;
        }
        .event-item.fire-theme .event-title, .event-item.fire-theme .event-prize { position: relative; z-index: 5; text-shadow: 2px 2px 4px #000; }
        .event-item.fire-theme .event-prize { color: #ffd700; }
        .event-item.fire-theme::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: conic-gradient(transparent, #ff0000, #ff4500, #ffff00, #ff0000);
            animation: rotateFireBorder 3s linear infinite; z-index: -2; 
        }
        .event-item.fire-theme::after {
            content: ''; position: absolute; top: 3px; left: 3px; right: 3px; bottom: 3px;
            background-color: #000; 
            background-image: url('https://media1.tenor.com/m/3Dv1dt0VcxUAAAAC/fire.gif');
            background-repeat: no-repeat; background-position: center center; background-size: 100% 100%;
            border-radius: 8px; z-index: -1; 
        }
        @keyframes rotateFireBorder { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Stego */
        .stego-input {
            width: 100%; padding: 15px; font-size: 18px; font-weight: bold; text-align: center; border-radius: 15px; border: none; outline: none; color: #fff; 
            background: linear-gradient(45deg, #ffd700, #50c878, #ffd700, #009b77); background-size: 300% 300%;
            animation: shimmerEffect 3s ease infinite; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        .stego-input::placeholder { color: rgba(255, 255, 255, 0.7); font-style: italic; font-weight: normal; }
        @keyframes shimmerEffect { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .wa-btn { background: #25D366; color: white; padding: 15px 30px; border-radius: 30px; border: none; font-weight: bold; font-size: 16px; margin-top: 20px; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; text-decoration: none; box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3); }

        .jodoh-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); 
            z-index: 10000 !important; display: flex; align-items: center; justify-content: center; flex-direction: column;
            opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }
        .jodoh-modal.active { opacity: 1; visibility: visible; }

        .choice-btn { padding: 15px 30px; border: none; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; color: white; margin: 0 10px; }
        .btn-if1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-if2 { background: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%); }
        .match-result-box { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; overflow: hidden; }
        .match-name { font-size: 24px; font-weight: bold; color: #2c3e50; margin: 15px 0; min-height: 60px; display: flex; align-items: center; justify-content: center;}
        .couple-display { display: none; margin-top: 10px; animation: slideUp 0.5s ease; }
        .couple-container { display: flex; flex-direction: column; gap: 10px; align-items: center; justify-content: center; margin-bottom: 10px; }
        .c-name-user { font-size: 18px; font-weight: 700; color: #2c3e50; }
        .c-heart { font-size: 30px; color: #e91e63; animation: heartbeat 1s infinite; }
        .c-name-partner { font-size: 18px; font-weight: 700; color: #e91e63; }
        .couple-sub { font-size: 13px; color: #7f8c8d; font-style: italic; margin-top: 5px; line-height: 1.4; padding: 0 5px; }
        .couple-gif { width: 140px; height: auto; border-radius: 10px; margin-top: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .special-title { font-size: 26px; font-weight: 800; color: #c0392b; margin-bottom: 10px; }
        .close-match { margin-top: 20px; background: #333; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;}
        .heart-beat { font-size: 60px; color: #e91e63; animation: heartbeat 1s infinite; margin-bottom: 20px; }

        @keyframes heartbeat { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        @media (max-width: 600px) {
            .grid-container { grid-template-columns: 1fr; padding: 0 10px; }
            .search-box { padding: 0 10px; }
            .pos-left { font-size: 10px; padding: 6px 10px; left: 10px; top: 15px; width: auto; max-width: 150px; }
            .pos-right { font-size: 0; padding: 8px 12px; right: 15px; top: 15px; }
            .pos-right i { margin: 0; font-size: 18px; }
            .pos-theme { right: 55px; width: 35px; height: 35px; font-size: 16px; top: 15px; padding: 0; }
            .event-box { top: 60px; left: 10px; padding: 6px 12px; font-size: 11px; }
            h1 { font-size: 1.8rem; }
            .grid-container.mobile-grid-active { grid-template-columns: repeat(2, 1fr) !important; gap: 10px; }
            .grid-container.mobile-grid-active .card { padding: 15px 10px; }
            .grid-container.mobile-grid-active .avatar { width: 45px; height: 45px; font-size: 16px; margin-bottom: 8px; }
            .grid-container.mobile-grid-active h3 { font-size: 13px; min-height: 40px; line-height: 1.2; margin-bottom: 5px; }
            .grid-container.mobile-grid-active .nim-badge { font-size: 10px; padding: 3px 8px; }
            .now-playing-box { bottom: 70px; max-width: 250px; }
        }
        
        .modal-box img { max-width: 100%; height: auto; }
        .stego-hint-wrapper { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 20px; background: rgba(100, 100, 100, 0.2); padding: 8px 12px; border-radius: 10px; border: 1px dashed #ffd700; width: 100%; box-sizing: border-box; }

        /* --- UPDATE CSS EVENT & COUNTDOWN --- */
        .event-item-content { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .event-left { text-align: left; }
        .event-right { text-align: right; background: rgba(0,0,0,0.4); padding: 5px 10px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.3); }
        .timer-label { font-size: 10px; color: #ffd700; text-transform: uppercase; margin-bottom: 2px; }
        .timer-digit { font-size: 14px; font-weight: 800; font-family: monospace; color: white; }
        .surrender-count-badge { margin-top: 5px; font-size: 11px; background: #fff; color: #c0392b; padding: 2px 8px; border-radius: 10px; font-weight: bold; display: inline-block; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* --- CSS MODAL NYERAH --- */
        .flag-emoji { font-size: 80px; animation: waveFlag 2s infinite ease-in-out; margin: 20px 0; }
        @keyframes waveFlag { 0% { transform: rotate(0deg); } 25% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } 100% { transform: rotate(0deg); } }
        .btn-giveup { background: #e74c3c; color: white; padding: 12px 25px; border-radius: 25px; border: none; font-weight: 600; cursor: pointer; font-size: 15px; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4); }
        .btn-giveup:hover { transform: scale(1.05); }
        
        /* --- CUSTOM DATE PICKER STYLES --- */
        .custom-picker-container { background: rgba(0,0,0,0.05); border-radius: 15px; padding: 15px; min-height: 300px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(128,128,128,0.2); }
        .picker-step { width: 100%; animation: fadeIn 0.3s ease; }
        .picker-grid { display: grid; gap: 10px; }
        .date-grid { grid-template-columns: repeat(7, 1fr); }
        .month-grid { grid-template-columns: repeat(3, 1fr); }
        .year-grid { grid-template-columns: repeat(4, 1fr); }
        .picker-btn { background: var(--card-bg); border: 1px solid rgba(0,0,0,0.1); color: var(--text-color); padding: 10px 5px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .picker-btn:hover { background: #3498db; color: white; transform: translateY(-2px); box-shadow: 0 5px 10px rgba(52, 152, 219, 0.3); }
        .picker-btn.active-select { background: #2ecc71; color: white; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 400px) { .date-grid { gap: 5px; } .picker-btn { padding: 8px 2px; font-size: 12px; } }

        /* --- CLASS SELECTOR TOGGLE (BARU) --- */
        .class-selector-box {
            position: fixed; top: 70px; right: 20px; z-index: 999;
            background: var(--fixed-bg); padding: 5px; border-radius: 30px;
            display: flex; gap: 5px; backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px); transform: translateZ(0); 
            border: 2px solid rgba(255,255,255,0.3); box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .class-selector-box:hover { transform: scale(1.02); }
        .cls-btn {
            border: none; background: transparent; color: var(--fixed-text);
            padding: 6px 15px; border-radius: 20px; font-weight: 700;
            font-family: 'Poppins', sans-serif; cursor: pointer; transition: 0.3s;
            font-size: 12px; opacity: 0.6;
        }
        .cls-btn:hover { opacity: 1; background: rgba(0,0,0,0.05); }
        .cls-btn.active { background: #3498db; color: white; opacity: 1; box-shadow: 0 2px 10px rgba(52, 152, 219, 0.4); }
        @media (max-width: 600px) { .class-selector-box { top: 60px; right: 10px; padding: 4px; } .cls-btn { padding: 5px 12px; font-size: 11px; } }

        /* --- KONAMI CODE EASTER EGG STYLES (UPDATED: BASS BEAT MODE) --- */
        body.konami-active {
            animation: rainbow-bg 1s infinite linear; 
        }
        @keyframes rainbow-bg {
            0% { filter: hue-rotate(0deg) saturate(2); } 
            100% { filter: hue-rotate(360deg) saturate(2); }
        }
        .card.konami-spin {
            animation: partyBeat 0.5s infinite cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
            border: 3px solid #fff;
            box-shadow: 0 0 20px rgba(255,255,255,0.8); 
        }
        @keyframes partyBeat {
            0% { transform: scale(1) rotate(0deg); }
            15% { transform: scale(1.15) rotate(3deg); border-color: #ff0055; box-shadow: 0 0 30px #ff0055; }
            30% { transform: scale(0.95) rotate(-2deg); border-color: #00ffea; }
            50%, 100% { transform: scale(1) rotate(0deg); border-color: #fff; }
        }
        .konami-avatar-img {
            width: 100%; height: 100%; object-fit: cover; border-radius: 50%;
        }
        
        /* --- STYLE UNTUK FITUR CLUE --- */
        .clue-btn-trigger {
            background: #8e44ad; color: white; padding: 10px 20px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 10px rgba(142, 68, 173, 0.4); display: flex; align-items: center; gap: 8px; margin-left: auto; margin-right: auto;
        }
        .clue-btn-trigger:hover { transform: scale(1.05); background: #9b59b6; }
        .clue-scroll-box { max-height: 300px; overflow-y: auto; padding-right: 5px; }
        .clue-item { background: rgba(0,0,0,0.05); border-left: 4px solid #f1c40f; padding: 12px; margin-bottom: 10px; border-radius: 5px; font-size: 13px; color: var(--text-color); line-height: 1.5; }
        .clue-number { font-weight: 800; color: #d35400; display: block; margin-bottom: 3px; font-size: 11px; text-transform: uppercase; }
        @media (max-width: 400px) { .btn-conf-primary, .btn-conf-close { padding: 10px 15px; font-size: 13px; } }

        /* --- MODERN TOAST NOTIFICATIONS --- */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10005; /* Harus paling atas melebihi modal */
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none; /* Agar area kosong tidak memblokir klik */
            align-items: center;
        }

        .toast-box {
            background: var(--fixed-bg);
            color: var(--fixed-text);
            padding: 12px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 5px solid #3498db; /* Default Biru */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: slideInDown 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            max-width: 90vw;
            pointer-events: auto; /* Boksnya tetap bisa diklik/disentuh */
            border-right: 1px solid rgba(255,255,255,0.2);
            border-top: 1px solid rgba(255,255,255,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .toast-box.success { border-left-color: #2ecc71; }
        .toast-box.error { border-left-color: #e74c3c; }
        .toast-box.warning { border-left-color: #f1c40f; }
        .toast-box.party { border-left-color: #9b59b6; animation: slideInDown 0.4s forwards, partyToast 1s infinite; }

        .toast-icon { font-size: 18px; }

        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes fadeOutUp {
            from { opacity: 1; transform: translateY(0) scale(1); }
            to { opacity: 0; transform: translateY(-20px) scale(0.9); }
        }

        @keyframes partyToast {
            0% { border-color: #ff0055; box-shadow: 0 0 15px rgba(255, 0, 85, 0.5); }
            50% { border-color: #00ffea; box-shadow: 0 0 15px rgba(0, 255, 234, 0.5); }
            100% { border-color: #ff0055; box-shadow: 0 0 15px rgba(255, 0, 85, 0.5); }
        }
    </style>
</head>
<body>

<div id="toast-container" class="toast-container"></div>

<div class="global-bg" id="bg-light-mode">
    <div class="glow glow-1"></div>
    <div class="glow glow-2"></div>
    <div class="glow glow-3"></div>
    <div class="stars-bg"></div>
    <div class="stars-sm-bg"></div>
</div>

<div class="global-bg" id="bg-dark-mode">
    <div class="star-layer layer-1" id="stars1"></div>
    <div class="star-layer layer-2" id="stars2"></div>
    <div class="star-layer layer-3" id="stars3"></div>
</div>
<div id="fireflies-container"></div>
<div id="copy-tooltip" class="copy-tooltip">NIM Disalin!</div>

<div id="playlist-box" class="playlist-box">
    <div class="playlist-inner">
        <div class="playlist-header">
            <span><i class="fas fa-list-ul"></i> Daftar Lagu</span>
            <span style="font-size:10px; opacity:0.6;">Auto-Play</span>
        </div>
        <div class="playlist-scroll" id="playlist-container"></div>
    </div>
</div>

<div id="now-playing-box" class="now-playing-box">
    <div class="np-icon" onclick="toggleNPBox()">
        <i class="fas fa-music"></i>
    </div>
    
    <div class="np-content">
        <div class="np-info">
            <div class="np-label">Sedang Memutar</div>
            <div class="np-title" id="np-title">Menunggu Lagu...</div>
        </div>
        <div class="np-controls">
            <button class="np-btn" id="btn-playlist-toggle" onclick="togglePlaylist()" title="Daftar Lagu">
                <i class="fas fa-list"></i>
            </button>
            <button class="np-btn" onclick="toggleMute()" title="Mute/Unmute">
                <i class="fas fa-volume-up" id="mute-icon"></i>
            </button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="selectionModal">
    <div class="modal-box">
        <h2 style="margin-bottom:20px; color:var(--text-color);">Mau Liat Kelas IF Berapa?</h2>
        <div style="display:flex; justify-content:center;">
            <button class="choice-btn btn-if1" onclick="loadClassData('IF1')">IF 1</button>
            <button class="choice-btn btn-if2" onclick="loadClassData('IF2')">IF 2</button>
        </div>
    </div>
</div>

<div class="mobile-layout-controls">
    <button class="mobile-btn active" onclick="setMobileList()" id="btnList"><i class="fas fa-list"></i> List</button>
    <button class="mobile-btn" onclick="setMobileGrid()" id="btnGrid"><i class="fas fa-th-large"></i> Petak</button>
</div>

<div id="main-view">
    <div class="fixed-element pos-left">Karya: Gilang Aidil Pratama</div>
    <div class="event-box" onclick="openEventModal()">
        <i class="fas fa-trophy"></i> Event
    </div>

    <button class="fixed-element pos-theme" id="themeToggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
    <a href="http://www.youtube.com/@DilzGhaaziy" target="_blank" class="fixed-element pos-right"><i class="fab fa-youtube"></i><span>Dilz Ghaaziy</span></a>

    <div class="class-selector-box">
        <button class="cls-btn active" id="btn-cls-if1" onclick="loadClassData('IF1')">IF 1</button>
        <button class="cls-btn" id="btn-cls-if2" onclick="loadClassData('IF2')">IF 2</button>
    </div>

    <div class="container">
        <header>
            <h1>Daftar Mahasiswa</h1>
            <p class="subtitle"><span id="class-name">Kelas</span> &bull; Cihuyyy</p>
            <div class="search-box">
                <input type="text" id="searchInput" onkeyup="filterNames()" placeholder="Cari nama atau NIM...">
            </div>
        </header>
        <div class="grid-container" id="cardGrid"></div>
    </div>
</div>

<div id="profile-view">
    
    <button class="back-btn-float" onclick="closeProfile()" style="position: absolute; top: 20px; left: 20px; padding: 10px 20px; background: var(--fixed-bg); border: none; border-radius: 20px; color: var(--fixed-text); font-weight: bold; cursor: pointer; z-index: 2005;"><i class="fas fa-arrow-left"></i> Kembali</button>

    <div class="profile-content">
        <div class="big-profile-card">
            <div class="big-avatar" id="p-avatar">GA</div>
            <h2 id="p-name" style="margin-bottom:5px;">Nama</h2>
            <div id="p-role" class="owner-role" style="display:none;">Pembuat Web</div>
            <div style="display:flex; align-items:center; justify-content:center; margin-bottom:20px;">
                <p id="p-nim" style="color:var(--text-color); margin:0;">NIM</p>
                <button class="copy-btn" onclick="copyNIM()"><i class="fas fa-copy"></i></button>
            </div>
            
            <div class="info-row"><span class="info-label">Angkatan</span><span class="info-val">2025</span></div>
            <div class="info-row"><span class="info-label">Kelas</span><span class="info-val" id="p-class">IF X</span></div>
            <div class="info-row"><span class="info-label">Jenis Kelamin</span><span class="info-val" id="p-gender">-</span></div>
            
            <div class="info-row">
                <span class="info-label">Tanggal Lahir</span>
                <span class="info-val">
                    <span id="p-dob">-</span> 
                    <i id="dob-edit-icon" class="fas fa-edit edit-icon" title="Edit Tanggal Lahir" onclick="initEditDOB()"></i>
                </span>
            </div>
            
            <div class="info-row"><span class="info-label">Dosen Pembimbing</span><span class="info-val" id="p-dospem">-</span></div>
            <div class="info-row" id="p-status-row" style="display: none;"><span class="info-label">Status Kuliah</span><span class="info-val" id="p-status-val">-</span></div>

            <button class="ipk-btn" onclick="openIPKModal()">
                <i class="fas fa-chart-line"></i> Lihat Detail IPK
            </button> 

            <button class="jodoh-btn" onclick="cekJodoh()">
                <i class="fas fa-heart"></i> Siapa Jodohmu?
            </button>
            <div class="quote-box" id="daily-quote">"Memuat kata-kata..."</div>
        </div>
    </div>
</div>

<div class="event-modal" id="eventModal">
    <div class="modal-box">
        <h2 style="color: var(--text-color);"><i class="fas fa-calendar-alt"></i> Event Aktif</h2>
        
        <div class="event-list" id="eventListContainer"></div>
        
        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
            <button class="btn-conf-primary" style="background: #8e44ad;" onclick="openClueSelection()">
                <i class="fas fa-search"></i> Clue
            </button>
            
            <button class="btn-conf-close" onclick="closeEventModal()">Tutup</button>
        </div>
    </div>
</div>

<div class="event-challenge-modal" id="challengeModal">
    <div class="modal-box">
        <h2 style="color: var(--text-color); margin-bottom: 5px;">Duel Dengan Owner. GRATIS KOK</h2>
        <p style="font-size: 12px; color: #7f8c8d; margin-bottom: 20px;">Chat Pembuat Event Untuk Diskusi / Terima Tantangan</p>
        <a href="https://wa.me/628311801213" target="_blank" class="wa-btn">
            <i class="fab fa-whatsapp"></i> Terima Tantangan
        </a>
        <br><br>
        <button class="btn-conf-close" onclick="closeChallengeModal()">Batal</button>
    </div>
</div>

<div class="ipk-modal" id="ipkModal">
    <div class="ipk-content">
        <div class="ipk-header">
            <h2>Riwayat IPK</h2>
            <p id="ipk-nama-mhs">Nama Mahasiswa</p>
        </div>
        <div class="semester-list" id="semesterList"></div>
        <button class="close-ipk" onclick="closeIPKModal()">Tutup</button>
    </div>
</div>

<div class="ipk-input-modal" id="ipkInputModal">
    <div class="modal-box">
        <h2 style="color: var(--text-color);">Input Nilai IPK</h2>
        <p style="font-size: 12px; color: #666;">Masukkan nilai antara 1.00 sampai 4.00</p>
        
        <input type="number" id="modern-ipk-input" class="modern-input-field" placeholder="0.00" step="0.01" min="1" max="4">
        
        <div style="display:flex; justify-content:center; gap:10px;">
            <button class="btn-conf-close" onclick="closeIpkInputModal()">Batal</button>
            <button class="btn-conf-primary" onclick="confirmIPKInput()">Simpan</button>
        </div>
    </div>
</div>

<div class="date-picker-overlay" id="datePickerModal">
    <div class="modal-box" style="width: 450px; max-width: 95%;">
        <h2 style="color: var(--text-color); margin-bottom: 5px;">Ubah Tanggal Lahir</h2>
        <p class="warning-text" id="picker-title-step">Pilih Tanggal</p>
        
        <div class="custom-picker-container">
            <div id="step-date" class="picker-step active">
                <div class="picker-grid date-grid" id="grid-dates"></div>
            </div>

            <div id="step-month" class="picker-step" style="display:none;">
                <div class="picker-grid month-grid" id="grid-months"></div>
            </div>

            <div id="step-year" class="picker-step" style="display:none;">
                <div class="picker-grid year-grid" id="grid-years"></div>
            </div>
        </div>

        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
            <button class="btn-conf-close" onclick="closeDatePicker()">Batal</button>
            <button class="btn-conf-close" id="btn-back-step" onclick="backStepPicker()" style="display:none; background: #f39c12;">Kembali</button>
        </div>
    </div>
</div>

<div class="verify-modal" id="verifyModal">
    <div class="modal-box">
        <h2 style="color: var(--text-color); font-size: 20px;">Memastikan Kalau Ini Adalah Kamu</h2>
        <p style="color: var(--text-color); margin-top: 10px; font-size: 14px;">
            masukkan 2 angka terakhir dari NIM mu, contohnya 55202250<span class="bold-ex">23</span>
        </p>
        <input type="tel" id="nim-verify-input" class="verify-input" maxlength="2" placeholder="XX" autocomplete="off">
        <div style="margin-top: 20px; display:flex; justify-content: center; gap: 10px;">
            <button class="btn-conf-close" onclick="closeVerifyModal()">Batal</button>
            <button class="btn-conf-primary" onclick="submitVerification()">Verifikasi</button>
        </div>
    </div>
</div>

<div class="date-confirm-overlay" id="dateConfirmModal">
    <div class="modal-box">
        <h2 style="color: var(--text-color); margin-bottom: 10px;">Konfirmasi</h2>
        <p style="color: var(--text-color); margin-bottom: 20px;">Tanggal Lahirnya Sudah Benar?</p>
        <div style="font-size: 20px; font-weight: bold; color: #3498db; margin-bottom: 30px;" id="conf-dob-display">-</div>
        <div class="confirm-btn-container">
            <button class="btn-cross" onclick="closeDateConfirm()"><i class="fas fa-times"></i></button>
            <button class="btn-check" onclick="initVerification()"><i class="fas fa-check"></i></button>
        </div>
    </div>
</div>

<div class="jodoh-modal" id="jodohModal">
    <div class="heart-beat"><i class="fas fa-heart"></i></div>
    <h2 style="color:white; margin-bottom:20px;">Mencari Koneksi Hati...</h2>
    <div class="match-result-box">
        <div id="searching-ui">
            <div style="font-size:12px; color:#aaa; margin-bottom:10px;">JODOH KAMU ADALAH</div>
            <div class="match-name" id="match-name-display">X</div>
        </div>
        <div class="couple-display" id="final-couple-ui"></div>
        <br>
        <button class="close-match" onclick="closeJodoh()">Tutup</button>
    </div>
</div>

<div class="modal-overlay" id="stegoModal">
    <div class="modal-box">
        <h2 style="color: var(--text-color); margin-bottom: 5px;">Yakin Kamu Bisa?</h2>
        <p style="font-size: 12px; color: #7f8c8d; margin-bottom: 20px;">
            Hanya Calon Hacker & Detekif Yang Bisa
        </p>
        
        <div class="stego-hint-wrapper">
            <div class="stego-hint-text">(Step 1)CARI SESUATU DI GAMBAR INI</div>
            <i class="fas fa-arrow-right arrow-anim"></i>
            
            <img src="https://od.lk/s/NjhfMTYyNzY1NzQ0Xw/Step%201.png" 
                 onclick="openStegoImage()" 
                 title="Klik untuk memperbesar" 
                 style="width: 60px !important; height: 60px !important; min-width: 60px; object-fit: cover; border-radius: 8px; border: 2px solid #fff; cursor: pointer; background: #000;">
        </div>

        <input type="text" id="stegoAnswerInput" class="stego-input" placeholder="Nemu Jawabannya?" autocomplete="off">
        
        <div style="margin-top: 20px; display:flex; justify-content: center; gap: 10px;">
            <button class="btn-conf-close" onclick="openSurrenderModal()" style="background:#e74c3c; color:white;">Nyerah </button>
            <button class="btn-conf-primary" onclick="checkStegoAnswer()">Konfirmasi</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="stegoImageModal" style="z-index: 11000;" onclick="closeStegoImage(event)">
    <div class="modal-box" style="background: transparent; box-shadow: none; max-width: 95%; text-align: center;">
        
        <img src="https://od.lk/s/NjhfMTYyNzY1NzQ0Xw/Step%201.png" 
             style="max-height: 60vh; border-radius: 10px; cursor: pointer; border: 2px solid #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.5);" 
             onclick="openImageTab(event, this.src)" 
             title="Klik untuk membuka gambar">
        
        <div style="margin-top: 20px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
            <button class="btn-conf-primary" style="background: #3498db;" onclick="openImageTab(event, 'https://od.lk/s/NjhfMTYyNzY1NzQ0Xw/Step%201.png')">
                <i class="fas fa-external-link-alt"></i> Buka Gambar
            </button>
            <button class="btn-conf-primary" style="background: #2ecc71;" onclick="downloadImage(event, 'https://od.lk/s/NjhfMTYyNzY1NzQ0Xw/Step%201.png')">
                <i class="fas fa-download"></i> Download Gambar
            </button>
        </div>

        <p style="color: white; margin-top: 20px; font-weight: bold; text-shadow: 0 2px 4px #000;">
            Klik area kosong untuk menutup
        </p>
    </div>
</div>

<div class="modal-overlay" id="stegoSuccessModal">
    <div class="modal-box" style="border: 2px solid #ffd700; box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);">
        <h2 style="color: var(--text-color); margin-bottom: 5px;">Hebat, Calon Hacker Ya?</h2>
        
        <div style="margin: 20px 0;">
            <i class="fas fa-money-bill-wave" style="font-size: 80px; background: -webkit-linear-gradient(#11998e, #38ef7d); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
        </div>
        
        <p style="font-size: 14px; font-weight: bold; color: var(--text-color); margin-bottom: 20px;">
            Selamat, Kamu Dapat 200 Ribu !<br>Screenshot & Kirim Ke Owner Web<br><br>Jelaskan Step-Stepmu Saat Menyelesaikannya.
        </p>
        
        <a href="https://wa.me/628311801213?text=Halo%20Min,%20saya%20berhasil%20memecahkan%20tantangan%20Steganography!" target="_blank" class="wa-btn">
            <i class="fab fa-whatsapp"></i> Ambil Hadiah
        </a>
        
        <br><br>
        <button class="btn-conf-close" onclick="closeStegoSuccess()">Tutup</button>
    </div>
</div>

<div class="modal-overlay" id="surrenderModal">
    <div class="modal-box">
        <h2 style="color: var(--text-color); margin-bottom: 5px;">Gak Sanggup? Hehe</h2>
        <div class="flag-emoji"></div>
        <p style="color: var(--text-color); margin-bottom: 20px; font-size: 13px;">
            Yakin mau nyerah? Kesempatan dapet 200rb hilang lho.
        </p>
        
        <div style="display:flex; justify-content:center; gap:10px;">
            <button class="btn-conf-close" onclick="closeSurrenderModal()">Gak Jadi</button>
            <button class="btn-giveup" onclick="confirmSurrender()">Iya Saya Menyerah</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="clueSelectionModal">
    <div class="modal-box">
        <h2 style="color: var(--text-color); margin-bottom: 20px;">Pilih Event</h2>
        <p style="font-size: 13px; color: #7f8c8d; margin-bottom: 20px;">Mau intip clue untuk event yang mana?</p>
        
        <button class="event-item fire-theme" onclick="openStegoClueList()" style="width:100%; margin-bottom:10px;">
            <div class="event-title" style="text-align:center;"> Steganography</div>
        </button>

        <button class="btn-conf-close" onclick="closeClueSelection()">Kembali</button>
    </div>
</div>

<div class="modal-overlay" id="clueListModal">
    <div class="modal-box" style="text-align: left;">
        <h2 style="color: var(--text-color); text-align: center; margin-bottom: 10px;">
            <i class="fas fa-lightbulb" style="color:#f1c40f;"></i> Petunjuk
        </h2>
        <p style="font-size: 12px; color: #7f8c8d; text-align: center; margin-bottom: 20px;">
            Gunakan petunjuk ini dengan bijak!
        </p>
        
        <div id="clue-container-list" class="clue-scroll-box"></div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="btn-conf-close" onclick="backToClueSelection()">Kembali</button>
        </div>
    </div>
</div>

<script>
     // --- KONFIGURASI VERSI WEB ---
    const APP_VERSION = "1.0"; 

    // --- FITUR AUTO-UPDATE SCRIPT ---
    (async function checkAppVersion() {
        console.log("Mengecek pembaruan script...");
        try {
            const response = await fetch(window.location.href + '?t=' + new Date().getTime(), {
                cache: "no-store"
            });
            if (!response.ok) return;
            const text = await response.text();
            const match = text.match(/const\s+APP_VERSION\s*=\s*"([^"]+)"/);
            if (match && match[1]) {
                const serverVersion = match[1];
                if (serverVersion !== APP_VERSION) {
                    console.log(`Versi Baru Ditemukan! Server: ${serverVersion}, Lokal: ${APP_VERSION}. Merefresh...`);
                    if ('caches' in window) {
                        const keys = await caches.keys();
                        await Promise.all(keys.map(key => caches.delete(key)));
                    }
                    window.location.reload(true);
                } else {
                    console.log("Script sudah versi terbaru.");
                }
            }
        } catch (error) {
            console.log("Gagal mengecek versi:", error);
        }
    })();
    
    // --- FUNGSI NOTIFIKASI MODERN ---
    function showNotification(message, type = 'info') {
        const container = document.getElementById('toast-container');
        if (!container) return;

        const toast = document.createElement('div');
        toast.className = `toast-box ${type}`;
        
        // Tentukan Icon berdasarkan tipe (Warna menyesuaikan CSS border)
        let icon = '<i class="fas fa-info-circle toast-icon" style="color: #3498db;"></i>';
        if (type === 'success') icon = '<i class="fas fa-check-circle toast-icon" style="color: #2ecc71;"></i>';
        if (type === 'error') icon = '<i class="fas fa-exclamation-circle toast-icon" style="color: #e74c3c;"></i>';
        if (type === 'warning') icon = '<i class="fas fa-exclamation-triangle toast-icon" style="color: #f1c40f;"></i>';
        if (type === 'party') icon = '';

        toast.innerHTML = `${icon} <span>${message}</span>`;
        container.appendChild(toast);

        // Hapus otomatis setelah 3.5 detik
        setTimeout(() => {
            toast.style.animation = 'fadeOutUp 0.3s ease forwards';
            toast.addEventListener('animationend', () => {
                toast.remove();
            });
        }, 3500);
    }

    const REPO_CONFIG = { owner: "DilzGhaaziy", name: "TestingDilz" };
    const eventsData = [ { title: "Duel Game Naruto Storm 4", prize: "Rp 60.000", theme: "normal" }, { title: "Steganography", prize: "Rp 200.000", theme: "fire" } ];

    let dataIF1 = [], dataIF2 = [], allStudents = [];
    let globalStats = { stego_surrender_count: 0 };

    // Gunakan DOMContentLoaded agar Modal muncul INSTAN
    document.addEventListener('DOMContentLoaded', () => {
        // Tampilkan modal pemilih kelas langsung
        document.getElementById('selectionModal').classList.add('active');
        
        // Setup awal tema & layout
        if(localStorage.getItem('theme')==='dark') { 
            document.body.classList.add('dark-mode'); 
            document.querySelector('#themeToggle i').classList.replace('fa-moon','fa-sun'); 
        }
        if(localStorage.getItem('mobileLayout')==='grid') setMobileGrid();

        // Mulai download data di background
        fetchStudentData();
        
        // Setup Bintang & Meteor
        createBackgroundStars();
        meteorLoop();
    });

        async function fetchStudentData() {
        try {
            // 1. Ambil Data Mahasiswa
            const response = await fetch('students.json?t=' + new Date().getTime());
            if (!response.ok) throw new Error("Gagal mengambil data mahasiswa");
            const data = await response.json();
            dataIF1 = data.IF1;
            dataIF2 = data.IF2;
            allStudents = [ ...dataIF1.map(s => ({...s, class:'IF 1'})), ...dataIF2.map(s => ({...s, class:'IF 2'})) ];

            // 2. Ambil Data Statistik (Surrender Count) - TAMBAHAN BARU
            const statsResponse = await fetch('stats.json?t=' + new Date().getTime());
            if (statsResponse.ok) {
                const stats = await statsResponse.json();
                globalStats.stego_surrender_count = stats.stego_surrender_count || 0;
            }

        } catch (error) {
            console.error(" Error loading data:", error);
        }
    }

    const quotes = ["Jadilah versi terbaik.", "Turu jalan ninjaku.", "10% ngetik 90% error.", "Aku belum cebok.", "Jodoh gak kemana.", "Tetap santuy.", "Kita akan mati kapan aja.", "Error 404 katanya.", "Ngoding dulu rawr.", "Cintailah otakmu, jangan ngoding tiap hari.", "Hidup seperti array.(Meme Spongebob)", "PHP tuh bukan pemberi harapan palsu.", "Kuliah Pulang Tidur.", "Uang habis.", "Oh Tuhan, ku sayang dia.", "Bersakit dahulu wisuda kemudian.", "Fokus masa depan.", "Joki hanya di Dilz Ghaaziy JOKI.", "Gak bosen tah ke Be Hots Mulu.", "Kamu udah mandi belum?", "Bahagia itu ketika bisa jajan terus.", "Nilai A buat Kalkulus itu MITOS.", "Masih hidup lu?", "Udah kuliah kok masih labil itu mindset.", "Kucing bawa motor pake helm", "Sayang, kok kamu gak ngabarin aku?", "Bismillah Umroh.", "Lu mah mending, lah gua...", "Jangan panggil aku anak kecil paman!", "Jual tanah demi gaji UMR, What? Total gaji seumur hidup gak sampe harga tanahnya", "Minta doa yang terbaik ke Ibu.", "Fokus, hiyak hiyak hiyak!", "Sebel ga sih nilai C?.", "Tugas kelar.", "Wifi kencang is anugerah.", "Kalo ada cobaan, ya cobain.", "Kalo kata aku, dia gak waras.", "Aku lagi nahan eeq.", "Calon Mahasiswa Cumlaude.", "Ijo Lumut - Ikatan Jomblo Lucu Imut.", "Informatika? Chat GPT!.", "Pergi ke warung beli kopi,(cakep) Ya abis itu pulang.", "Algoritma cinta.", "Ada ide? Chat pribadi ke Owner web ini ya.", "Kayaknya kalo makan mie sukses terus, bisa jadi orang sukses.", "Apa yang kamu harapin dari dia?.", "Aku tak pernah, untuk mencintai...", "Ego vs Ego = Hubungan gak sehat.", "Katamu, pacarmu cuma satu.", "Array of hope.", "Informatika?! Cihuyyyy!.", "Ganteng pendiem = Cool.|Jelek pendiem = Introvert", "Duel Game Naruto sama Owner, Menang dapet 100 ribu.", "Bug adalah fitur.", "Ctrl+C Ctrl+V.", "Cihuyyyyy.", "Dibuat makalah minimal 15 lembar ya :).", "Kurang apa nih webnya?.", "Ga suka libur, gak ada jokian.", "Adalah pokoknya.", "Om jangan om", "Tolong jokiin hidupku.", "Searching makna.", "Nyari masalah?", "Recursion.", "Memory leak.", "Garbage collection.", "Compile error.", "Runtime exception.", "Debug hidup.", "Deploy bahagia.", "Version control.", "Git commit.", "Git push.", "Git pull.", "Merge conflict.", "Branch baru.", "Master skills.", "Main function happy.", "Include doa.", "Import sukses.", "Print Hello.", "Return 0.", "Void sedih.", "Public static.", "System out.", "Console log.", "Echo bisa.", "Select rejeki.", "Insert usaha.", "Update skill.", "Delete pikiran.", "Drop malas.", "Create view.", "Grant success.", "Revoke gagal.", "Commit.", "Rollback dosa.", "Savepoint.", "Connect God.", "Disconnect toxic."];

    const coupleVariations = [
        { t: "Ciee, dunia serasa milik berdua nih.", type: "cute" }, { t: "Semoga langgeng sampai wisuda ya!", type: "cute" }, { t: "Aduh gemes banget liatnya.", type: "cute" }, { t: "Cocok banget, kayak kopi sama gula.", type: "cute" }, { t: "Udah jadian aja belum sih?", type: "cute" }, { t: "Kiw kiw cukurukuk ebew rawr well ungrr.", type: "cute" }, { t: "Jangan lupa undang-undang kalau nikah.", type: "cute" }, { t: "Liat kalian berdua bikin iri jomblo.", type: "cute" }, { t: "Chemistry-nya dapet banget!", type: "cute" }, { t: "Kawal sampai halal pokoknya!", type: "cute" }, { t: "Senyumnya mirip, jodoh beneran nih.", type: "cute" }, { t: "Semesta merestui hubungan ini.", type: "cute" }, { t: "Gak usah malu-malu, tembak aja langsung.", type: "cute" }, { t: "Pasangan ter-uwu di angkatan 2025.", type: "cute" }, { t: "Bahagia terus ya kalian berdua.", type: "cute" }, { t: "Kayak ada manis-manisnya gitu.", type: "cute" }, { t: "Fix, tahun depan nyebar undangan.", type: "cute" }, { t: "Cintaku bersemi di ruang C3.", type: "cute" }, { t: "Jangan berantem terus ya, sayang kuotanya.", type: "cute" }, { t: "Semoga jodoh dunia akhirat.", type: "cute" }, { t: "Lucu banget cii kalian.", type: "cute" }, { t: "Tatapan matanya itu lho, dalem banget.", type: "cute" }, { t: "Yang satu ganteng, yang satu cantik. Pas!", type: "cute" }, { t: "Jodoh emang gak kemana, ternyata seprodi.", type: "cute" }, { t: "Semoga kalian selalu bahagia bersama.", type: "cute" },
        { t: "Hadeh, kasian banget jodohnya sama dia.", type: "mock" }, { t: "Yakin mau sama dia? Pikir lagi deh 7x24 jam.", type: "mock" }, { t: "Siap-siap makan ati ya tiap hari.", type: "mock" }, { t: "Jodoh sih, tapi kok kayak terpaksa gitu mukanya?", type: "mock" }, { t: "Awas, dia galak loh kalau lagi laper.", type: "mock" }, { t: "Kuat-kuatin iman ya ngadepin dia.", type: "mock" }, { t: "Yah, nasibmu kurang beruntung dapet dia.", type: "mock" }, { t: "Kok bisa sih jodohnya sama modelan begini?", type: "mock" }, { t: "Sabar ya, ini ujian hidup.", type: "mock" }, { t: "Dompet aman? Dia doyan jajan.", type: "mock" }, { t: "Mending pura-pura gak kenal aja deh.", type: "mock" }, { t: "Selamat menikmati penderitaan.", type: "mock" }, { t: "Dia tidurnya ngorok, yakin mau?", type: "mock" }, { t: "Jodoh sih, tapi boong (canda deng).", type: "mock" }, { t: "Aduh, turun standar banget dapet dia.", type: "mock" }, { t: "Dia suka nahan eeq.", type: "mock" }, { t: "Dia kalau mandi lama banget weee, awas telat ngampus.", type: "mock" }, { t: "Dia kalo bales chat bisa 3 hari, sabar ya.", type: "mock" }, { t: "Hati-hati, dia buaya/kucing garong berkedok mahasiswa.", type: "mock" }, { t: "Yakin mentalmu kuat? Dia drama queen/king.", type: "mock" }, { t: "Duh, sainganmu berat (sama hobi tidurnya).", type: "mock" }, { t: "Pasti kamu banyak dosa makanya dapet dia.", type: "mock" }, { t: "Jangan kaget kalau dia tiba-tiba minjem duit.", type: "mock" }, { t: "Selamat menempuh hidup penuh huru-hara.", type: "mock" }, { t: "Cinta itu buta.", type: "mock" }
    ];
    const cuteGifs = ["https://media.tenor.com/36d8ovZxZsgAAAAi/bubu-bubu-dudu.gif", "https://media.tenor.com/qQmsOJoeMoMAAAAi/dudu-bubu.gif", "https://media.tenor.com/Eazcnx5O-bgAAAAM/dudu-dudu-cute.gif", "https://media.tenor.com/pN7xf12qQcwAAAAM/cuddle-cute.gif", "https://media.tenor.com/RDwCMZeZ7b8AAAAi/hugs.gif", "https://media.tenor.com/wA5xWw0tNBwAAAAi/h%C3%AAh.gif", "https://media.tenor.com/9Pnoc6MKDrEAAAAi/love-you-too.gif", "https://media.tenor.com/JcPATwwdUOQAAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/pdv5YIMB-hkAAAAi/cute.gif", "https://media1.tenor.com/m/z2TX5B4RD34AAAAC/your-so-cute-mini-seb.gif", "https://media1.tenor.com/m/pjBtpAFSnmgAAAAC/peach-goma-peach-and-goma.gif", "https://media1.tenor.com/m/FYrmLKoB1UIAAAAC/peach-and-goma-peach-loves-goma.gif", "https://media.tenor.com/Zrr4L_Wd4JkAAAAi/bubu-rub-bubu-love-dudu.gif", "https://media.tenor.com/vzkveVGDzmAAAAAi/dudu-hug-bubu-dudu-kiss.gif", "https://media1.tenor.com/m/hOmnC-qwGagAAAAC/peach-and-goma.gif", "https://media.tenor.com/KqqtGmNZ_vkAAAAi/bubu-dudu.gif", "https://media.tenor.com/rjnOQXkO-TEAAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/wKP-p_HtfOoAAAAi/bubu-dudu.gif", "https://media.tenor.com/cqGxLDiHeKoAAAAi/bubu-dudu-bubu-dudu-love.gif", "https://media.tenor.com/MkU0kjfQnngAAAAi/kiss-bubu.gif", "https://media.tenor.com/vEvRDC60wpoAAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/u7fyNJeFi44AAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/fQ0oZELv1y4AAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/UeanLw-I3B4AAAAi/tkthao219-bubududu.gif", "https://media.tenor.com/vJRHkcdlEQQAAAAi/casal-dudu.gif", "https://media.tenor.com/tnTcMaEkXzAAAAAi/tonibear-bubu.gif", "https://media.tenor.com/Zc42xR3zFWYAAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/NgAmTbY1aokAAAAi/dare-aggie-dare-aggie-bunny.gif", "https://media.tenor.com/S_lMGnbCMzYAAAAi/bubu-bubu-dudu.gif", "https://media.tenor.com/3BTNvUaCiGgAAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/wG7yYjwS7F8AAAAi/milk-and-mocha-sleeping.gif", "https://media1.tenor.com/m/2BrMVhEIsgIAAAAC/mocha-bear-kiss-bear-kiss.gif", "https://media1.tenor.com/m/1gf_Jz8WYH0AAAAC/sami-en-dina-sami-dina.gif", "https://media1.tenor.com/m/WAqsZeIoxnEAAAAC/milk-and-mocha-milk-and-mocha-kiss.gif"];
    const mockGifs = ["https://media.tenor.com/vu0bClH3OiUAAAAM/bubu-dudu-sseeyall.gif", "https://media.tenor.com/8Hs24bl0z94AAAAM/12.gif", "https://media.tenor.com/IFAObJVF4tEAAAAi/bubu-dudu.gif", "https://media.tenor.com/2L3bWLooqT8AAAAi/bubu-silly.gif", "https://media1.tenor.com/m/ddBFqmr_qp0AAAAC/laughing-bubu.gif", "https://media.tenor.com/eSMmyYMJXOcAAAAi/miss-you.gif", "https://media.tenor.com/KmIZbENMqx4AAAAi/bubu-dudu-sseeyall.gif", "https://media1.tenor.com/m/KUGbLzdDd9YAAAAC/bubu-dudu.gif", "https://media.tenor.com/7awxGekCrFoAAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/SzjZCjI1kZQAAAAi/bubu-bubu-dudu.gif", "https://media.tenor.com/RhdwDUpRXeMAAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/LC74nzQObQ0AAAAi/bubu-dudu.gif", "https://media.tenor.com/tJk6yhct0wMAAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/kTIu00Dc0WwAAAAi/hi.gif", "https://media.tenor.com/WZyHt5hOIKsAAAAi/bubu-bubu-dudu.gif", "https://media.tenor.com/wSjhsZknWUsAAAAi/bubu-dudu-sseeyall.gif", "https://media.tenor.com/9gBByPt6k4oAAAAi/bubu-dudu-twitter.gif"];

    let availableVariationIndices = Array.from({length: coupleVariations.length}, (_, i) => i);
    let currentClassData = [], currentClassLabel = "", currentProfile = null;
    let bgmAudio = new Audio();
    let jodohAudio = new Audio(); 
    let currentBgmIndex = -1;
    let currentJodohSongIndex = -1;
    let isMuted = false;
    let userInteracted = false; 
    let radioTimeout = null; 
    let npBoxTimeout = null;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    const bgmPlaylist = [
        {title: "DBFM Radio Pemda", url: "https://pu.klikhost.com/proxy/dbfm/stream"}, 
        {title: "iSWARA Jakarta FM", url: "https://n13.radiojar.com/4ywdgup3bnzuv?rj-ttl=5&rj-tok=AAABnECWuWQAm41UJbq3s9BypA"},
        {title: "iSWARA Banjarmasin FM", url: "https://stream.radiojar.com/qfqd2aw80k8uv"},
        {title: "SmartFM", url: "https://cast2.my-control-panel.com/proxy/radioso3/stream"}, 
        {title: "Mettaswara Dangdut FM", url: "http://mettaswara.com:8700/d4d"},
        {title: "Mettaswara Koplo FM", url: "http://mettaswara.com:8700/koplo"},
        {title: "Tebet Radio FM", url: "https://stream-ssl.arenastreaming.com:8066/stream"},
        {title: "RTC Radio FM", url: "https://stream.pamula.xyz/listen/rtc_ui/radio.mp3"},
        {title: "JGRP Radio Live", url: "https://s7.alhastream.com/radio/8350/live"}
    ];

    const jodohSongs = [
        "https://od.lk/s/NjhfMTYyNzYyNDI5Xw/Beautiful%20in%20white%20CUT_2_2.mp3",
        "https://od.lk/s/NjhfMTYyNzYyNDMxXw/Rewrite%20the%20start%20CUT.mp3",
        "https://od.lk/s/NjhfMTYyNzYyNDU0Xw/dandelions%20CUT.mp3",
        "https://od.lk/s/NjhfMTYyNzYyNDYwXw/Melukis%20Senja%20CUT.mp3",
        "https://od.lk/s/NjhfMTYyNzYyNDYxXw/Love%20Story%20CUT.mp3"
    ];

    const S_MATI = "https://od.lk/s/NjhfMTYyNzYyNDE7Xw/Ingat%20Mati%20CUT.mp3";
    const S_ISLAMI = "https://od.lk/s/NjhfMTYyNzYyNDE5Xw/Haaaaa%20Islami%20CUT.mp3";
    const S_FUNNY = "https://od.lk/s/NjhfMTYyNzYyNDIwXw/Alur%20Cerita%20FB%20CUT.mp3";
    const S_SAD = "https://od.lk/s/NjhfMTYyNzYyNDE1Xw/Sampai%20kini%20masih%20ku%20coba%20CUT.mp3";
    const S_YALILI = "https://od.lk/s/NjhfMTYyNzYyNDE1Xw/Yalil%20Yalili%20CUT.mp3";
    const CEO_NAMES = ["CEO MBG", "CEO Cendol", "CEO Ayam Potong", "CEO Gorengan", "CEO Ayam Geprek", "CEO Seblak", "CEO EpEp", "CEO Pecel Lele", "CEO Tahu Bulat"];

    // Optimasi Pembuatan Bintang (DocumentFragment)
    function createBackgroundStars() {
        createStarLayer('stars1', 150, 1); // Dikurangi jumlahnya agar tidak berat
        createStarLayer('stars2', 50, 2);
        createStarLayer('stars3', 10, 3);
    }

    function createStarLayer(containerId, count, size) {
        const container = document.getElementById(containerId);
        if(!container) return;
        
        const fragment = document.createDocumentFragment();
        
        let boxShadows = [];
        for (let i = 0; i < count; i++) {
            const x = Math.floor(Math.random() * window.innerWidth);
            const y = Math.floor(Math.random() * 2000); 
            boxShadows.push(`${x}px ${y}px #FFF`);
        }
        
        const star = document.createElement('div');
        star.classList.add('star-field');
        star.style.width = size + 'px';
        star.style.height = size + 'px';
        star.style.boxShadow = boxShadows.join(', ');
        
        const clone = star.cloneNode(true);
        clone.style.position = 'absolute';
        clone.style.top = '2000px'; 
        
        fragment.appendChild(star);
        fragment.appendChild(clone);
        container.appendChild(fragment);
    }

    // Meteor: Hanya berjalan di Dark Mode & Tab Aktif
    let isTabActive = true;
    let meteorTimeout;
    const scene = document.getElementById('bg-dark-mode'); 

    document.addEventListener('visibilitychange', () => {
        isTabActive = !document.hidden;
        if (isTabActive) meteorLoop();
    });

    function spawnMeteor() {
        if (!isTabActive || !document.body.classList.contains('dark-mode')) return;

        const meteor = document.createElement('div');
        meteor.classList.add('meteor');

        const headSize = Math.random() * 3 + 2; 
        const tailLength = headSize * (Math.random() * 50 + 50);
        const startX = Math.random() * 120 + 20; 
        const duration = Math.random() * 1.5 + 0.8;

        meteor.style.width = tailLength + 'px';
        meteor.style.height = (headSize * 0.7) + 'px';
        meteor.style.left = startX + 'vw';
        meteor.style.top = '-100px';
        meteor.style.animation = `shooting ${duration}s linear forwards`;

        const head = document.createElement('div');
        head.classList.add('meteor-head');
        head.style.width = headSize + 'px';
        head.style.height = headSize + 'px';
        head.style.boxShadow = `0 0 ${headSize * 4}px ${headSize}px rgba(100, 200, 255, 0.9)`;
        
        meteor.appendChild(head);
        
        // Cleanup DOM otomatis setelah animasi selesai
        meteor.addEventListener('animationend', () => { meteor.remove(); });
        if(scene) scene.appendChild(meteor);
    }

    function meteorLoop() {
        clearTimeout(meteorTimeout);
        if (isTabActive && document.body.classList.contains('dark-mode')) {
            spawnMeteor();
        }
        // Interval acak
        const randomDelay = Math.random() * 2000 + 500;
        meteorTimeout = setTimeout(meteorLoop, randomDelay);
    }

    // --- AUDIO FUNCTIONS ---
    function toggleNPBox() {
        const box = document.getElementById('now-playing-box');
        const playlist = document.getElementById('playlist-box');
        box.classList.toggle('expanded');
        if (!box.classList.contains('expanded')) {
            playlist.classList.remove('show');
            document.getElementById('btn-playlist-toggle').classList.remove('active-list');
        }
    }

    function togglePlaylist() {
        const playlistBox = document.getElementById('playlist-box');
        const btn = document.getElementById('btn-playlist-toggle');
        if (!playlistBox.classList.contains('show')) { renderPlaylist(); }
        playlistBox.classList.toggle('show');
        btn.classList.toggle('active-list');
    }

    function renderPlaylist() {
        const container = document.getElementById('playlist-container');
        container.innerHTML = "";
        bgmPlaylist.forEach((track, index) => {
            const isPlaying = (index === currentBgmIndex && !bgmAudio.paused);
            const item = document.createElement('div');
            item.className = `track-item ${isPlaying ? 'playing' : ''}`;
            item.onclick = () => playSpecificBGM(index);
            item.innerHTML = `
                <div class="track-icon"><i class="fas ${isPlaying ? 'fa-volume-up' : 'fa-play'}"></i></div>
                <div class="track-info"><div class="track-name">${track.title}</div><div class="track-status">${isPlaying ? 'Sedang Diputar' : 'Klik untuk memutar'}</div></div>`;
            container.appendChild(item);
        });
    }

    function tryPlayDefaultRadio() {
        if (!userInteracted) return;
        currentBgmIndex = 0; 
        playSpecificBGM(0, true);
        if (radioTimeout) clearTimeout(radioTimeout);
        radioTimeout = setTimeout(() => {
            if (bgmAudio.paused || bgmAudio.readyState < 3) { playRandomBGM(); }
        }, 5000); 
    }

    function playSpecificBGM(index, isStartup = false) {
        if (currentBgmIndex === index && !bgmAudio.paused && !isStartup) {
             bgmAudio.pause(); renderPlaylist(); return;
        }
        jodohAudio.pause(); jodohAudio.currentTime = 0;
        currentBgmIndex = index;
        bgmAudio.src = bgmPlaylist[currentBgmIndex].url;
        bgmAudio.volume = isMuted ? 0 : 1.0;
        bgmAudio.onerror = function() {
            if (isStartup) { playRandomBGM(); } else { updateNPUI("DBFM Lagi Offline"); }
        };
        const playPromise = bgmAudio.play();
        if (playPromise !== undefined) {
            playPromise.then(() => {
                updateNPUI(bgmPlaylist[currentBgmIndex].title);
                renderPlaylist(); 
                if(isStartup && radioTimeout) clearTimeout(radioTimeout);
            }).catch(e => { if(isStartup) playRandomBGM(); });
        }
        bgmAudio.onended = playRandomBGM; 
    }

    function updateNPUI(title) {
        document.getElementById('np-title').innerText = title;
        const box = document.getElementById('now-playing-box');
        const playlist = document.getElementById('playlist-box');
        box.classList.add('expanded');
        if (npBoxTimeout) clearTimeout(npBoxTimeout);
        npBoxTimeout = setTimeout(() => {
            if (!playlist.classList.contains('show')) { box.classList.remove('expanded'); }
        }, 5000); 
    }

    function playRandomBGM() {
        if (!userInteracted) return;
        if (radioTimeout) clearTimeout(radioTimeout);
        bgmAudio.pause();
        let newIdx;
        do { newIdx = Math.floor(Math.random() * bgmPlaylist.length); } while ((newIdx === currentBgmIndex || newIdx === 0) && bgmPlaylist.length > 1);
        currentBgmIndex = newIdx;
        bgmAudio.src = bgmPlaylist[currentBgmIndex].url;
        bgmAudio.volume = 0; 
        bgmAudio.onerror = () => { playRandomBGM(); };
        const playPromise = bgmAudio.play();
        if (playPromise !== undefined) {
            playPromise.then(() => {
                fadeInBGM(); updateNPUI(bgmPlaylist[currentBgmIndex].title); renderPlaylist(); 
                document.getElementById('now-playing-box').classList.add('expanded');
            }).catch(error => { console.log("Autoplay blocked."); });
        }
        bgmAudio.onended = playRandomBGM;
    }

    function fadeInBGM() {
        let vol = 0;
        const fade = setInterval(() => { 
            if(vol < 1.0) { vol += 0.1; if(!isMuted) bgmAudio.volume = Math.min(vol, 1.0); } else { clearInterval(fade); }
        }, 100);
    }

    function toggleMute() {
        isMuted = !isMuted;
        bgmAudio.muted = isMuted; jodohAudio.muted = isMuted;
        document.getElementById('mute-icon').className = isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
    }

    function playRandomJodohSong() {
        let newIdx;
        do { newIdx = Math.floor(Math.random() * jodohSongs.length); } while (newIdx === currentJodohSongIndex && jodohSongs.length > 1);
        currentJodohSongIndex = newIdx;
        jodohAudio.src = jodohSongs[currentJodohSongIndex];
        jodohAudio.play(); jodohAudio.onended = playRandomJodohSong; 
    }

    function getStudentCoupleContent() {
        if (availableVariationIndices.length === 0) {
            availableVariationIndices = Array.from({length: coupleVariations.length}, (_, i) => i);
        }
        const randomIndex = Math.floor(Math.random() * availableVariationIndices.length);
        const selectedIndex = availableVariationIndices[randomIndex];
        availableVariationIndices.splice(randomIndex, 1);
        const variation = coupleVariations[selectedIndex];
        let gifUrl = variation.type === 'cute' ? cuteGifs[Math.floor(Math.random() * cuteGifs.length)] : mockGifs[Math.floor(Math.random() * mockGifs.length)];
        return { text: variation.t, gif: gifUrl };
    }
    
    function playTick() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
        osc.type = 'square'; osc.frequency.setValueAtTime(800, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.05);
        gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
        osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.05);
    }

    function loadClassData(type) {
        if (!userInteracted) {
            userInteracted = true;
            if(bgmAudio.paused) { tryPlayDefaultRadio(); }
        }
        
        const grid = document.getElementById('cardGrid');
        grid.innerHTML = "";
        
        // Setup Variabel Kelas
        currentClassData = (type === 'IF1') ? dataIF1 : dataIF2;
        currentClassLabel = (type === 'IF1') ? "IF 1" : "IF 2";
        document.getElementById('class-name').innerText = currentClassLabel;
        
        // --- TAMBAHAN BARU: Update Tampilan Tombol Selector ---
        const btn1 = document.getElementById('btn-cls-if1');
        const btn2 = document.getElementById('btn-cls-if2');
        
        // Cek jika elemen tombol sudah ada di HTML (Mencegah error saat load awal modal)
        if (btn1 && btn2) {
            if (type === 'IF1') {
                btn1.classList.add('active');
                btn2.classList.remove('active');
            } else {
                btn1.classList.remove('active');
                btn2.classList.add('active');
            }
        }
        // -----------------------------------------------------

        const fragment = document.createDocumentFragment();
        currentClassData.forEach((s, index) => {
            const card = document.createElement('div'); 
            let cardClass = 'card'; let roleBadge = '';
            
            if (s.isOwner) { cardClass += ' owner-card'; roleBadge = `<div class="owner-badge"><i class="fas fa-crown"></i> Owner</div>`; } 
            else if (s.role === "Ketua IF 1" || s.role === "Ketua IF 2") { cardClass += ' ketua-card'; roleBadge = `<div class="ketua-badge"><i class="fas fa-user-tie"></i> ${s.role}</div>`; }
            else if (s.role === "Wakil IF2") { cardClass += ' wakil-if2-card'; roleBadge = `<div class="wakil-if2-badge"><i class="fas fa-star"></i> Wakil</div>`; }
            else if (s.role === "Wakil 1 IF1") { cardClass += ' wakil1-card'; roleBadge = `<div class="wakil1-badge"><i class="fas fa-star"></i> ${s.role}</div>`; }
            else if (s.role === "Wakil 2 IF1") { cardClass += ' wakil2-card'; roleBadge = `<div class="wakil2-badge"><i class="fas fa-star-half-alt"></i> ${s.role}</div>`; }
            else if (s.role === "Keamanan IF1") { cardClass += ' keamanan-card'; roleBadge = `<div class="keamanan-badge"><i class="fas fa-shield-alt"></i> ${s.role}</div>`; }
            else if (s.role === "PJ Matkul") {
                if (s.name.includes("Leni")) { cardClass += ' pj-leni-card'; roleBadge = `<div class="pj-badge pj-leni-badge"><i class="fas fa-book"></i> ${s.role}</div>`; } 
                else if (s.name.includes("Nirwanda")) { cardClass += ' pj-nirwanda-card'; roleBadge = `<div class="pj-badge pj-nirwanda-badge"><i class="fas fa-book"></i> ${s.role}</div>`; }
            }
            
            card.className = cardClass;
            card.dataset.index = index;
            card.innerHTML = `${roleBadge}<div class="gender-tag ${s.gender==='L'?'gender-L':'gender-P'}">${s.gender}</div><div class="avatar">${getInitials(s.name)}</div><h3>${s.name}</h3><span class="nim-badge">${s.nim}</span>`;
            fragment.appendChild(card);
        });
        
        grid.appendChild(fragment); 
        
        // Tutup modal awal jika masih terbuka
        const selectionModal = document.getElementById('selectionModal');
        if (selectionModal) selectionModal.classList.remove('active');
    }

    // --- OPTIMASI MOUSEMOVE (TanPA Layout Thrashing) ---
    if (window.matchMedia("(hover: hover)").matches) {
        const grid = document.getElementById('cardGrid');
        let activeCard = null;
        let cardRect = null;

        // Hitung ukuran HANYA saat mouse mulai masuk ke kartu
        grid.addEventListener('mouseover', function(e) {
            const card = e.target.closest('.card');
            if (card) {
                activeCard = card;
                cardRect = card.getBoundingClientRect(); 
            }
        });

        // Hapus data memori saat mouse keluar dari kartu
        grid.addEventListener('mouseout', function(e) {
            activeCard = null;
            cardRect = null;
        });

        // Saat mouse bergerak, gunakan data yang sudah disimpan
        grid.addEventListener('mousemove', function(e) {
            if (activeCard && cardRect) {
                requestAnimationFrame(() => {
                    const x = e.clientX - cardRect.left;
                    const y = e.clientY - cardRect.top;
                    activeCard.style.setProperty('--x', `${x}px`);
                    activeCard.style.setProperty('--y', `${y}px`);
                });
            }
        });
    }

    document.getElementById('cardGrid').addEventListener('click', function(e) {
        const card = e.target.closest('.card');
        if (card) {
            const index = card.dataset.index;
            if (currentClassData[index]) { openProfile(currentClassData[index]); }
        }
    });

 function openProfile(s) {
        currentProfile = s;
        if(!isMuted) bgmAudio.volume = 0.2;
        
        // Set Data Text
        document.getElementById('p-avatar').innerText = getInitials(s.name);
        document.getElementById('p-name').innerText = s.name;
        document.getElementById('p-nim').innerText = s.nim;
        document.getElementById('p-class').innerText = currentClassLabel;
        document.getElementById('p-gender').innerText = s.gender==='L'?'Laki-Laki':'Perempuan';
        document.getElementById('p-dob').innerText = s.dob;
        document.getElementById('p-dospem').innerText = s.dospem;
        
        // Logika Tombol Edit DOB
        const hasEdited = localStorage.getItem(`dob_edited_${s.nim}`);
        const dobIcon = document.getElementById('dob-edit-icon');
        if (hasEdited === "true") {
            dobIcon.classList.add('faded');
            dobIcon.onclick = function() { showNotification("Tanggal Lahir di Profil ini sudah pernah diubah", "warning"); };
        } else {
            dobIcon.classList.remove('faded');
            dobIcon.onclick = initEditDOB;
        }

        // Status Kuliah
        const statusRow = document.getElementById('p-status-row');
        if(s.status) { document.getElementById('p-status-val').innerText = s.status; statusRow.style.display = 'flex'; } else { statusRow.style.display = 'none'; }
        
        // --- LOGIKA TEMA WARNA PROFIL (PERBAIKAN) ---
        const profileCard = document.querySelector('.big-profile-card');
        const roleDiv = document.getElementById('p-role');
        
        // Reset class ke default dulu
        profileCard.className = 'big-profile-card'; 
        
        // Reset style badge role kecil
        roleDiv.className = 'owner-role';
        roleDiv.style.background = ""; roleDiv.style.color = ""; roleDiv.style.border = "";

        if (s.isOwner) { 
            profileCard.classList.add('owner-profile'); 
            roleDiv.innerText = "Pembuat Web"; 
            roleDiv.style.display = 'inline-block'; 
        } 
        else if (s.role) {
            roleDiv.innerText = s.role; 
            roleDiv.style.display = 'inline-block';
            
            // Cek string role untuk menerapkan tema
            if (s.role.includes('Ketua')) { 
                profileCard.classList.add('ketua-profile'); 
                roleDiv.classList.add('ketua-role-tag'); 
            } 
            else if (s.role === "Wakil IF2") { 
                profileCard.classList.add('wakil-if2-profile'); 
                roleDiv.style.background = "#fff"; roleDiv.style.color = "#00c6fb"; 
            } 
            else if (s.role === "Wakil 1 IF1") { 
                profileCard.classList.add('wakil1-profile'); 
                roleDiv.style.background = "#fff"; roleDiv.style.color = "#8e44ad"; 
            } 
            else if (s.role === "Wakil 2 IF1") { 
                profileCard.classList.add('wakil2-profile'); 
                roleDiv.style.background = "#fff"; roleDiv.style.color = "#e67e22"; 
            } 
            else if (s.role === "Keamanan IF1") { 
                profileCard.classList.add('keamanan-profile'); 
                roleDiv.style.background = "#000"; roleDiv.style.color = "#ff0000"; roleDiv.style.border = "1px solid red"; 
            } 
            else if (s.role === "PJ Matkul") {
                if(s.name.includes("Leni")) { 
                    profileCard.classList.add('pj-leni-profile'); 
                    roleDiv.style.background = "#ff6f91"; roleDiv.style.color = "#fff"; 
                } 
                else { 
                    // Asumsi PJ Nirwanda
                    profileCard.classList.add('pj-nirwanda-profile'); 
                    roleDiv.style.background = "#fff"; roleDiv.style.color = "#800020"; 
                }
            }
        } else { 
            // Mahasiswa Biasa (Tanpa Role)
            roleDiv.style.display = 'none'; 
        }

        document.getElementById('daily-quote').innerText = `"${quotes[Math.floor(Math.random()*quotes.length)]}"`;
        
        // Animasi Buka
        document.getElementById('main-view').style.opacity = '0';
        setTimeout(() => { 
            document.getElementById('main-view').style.display = 'none'; 
            document.getElementById('profile-view').style.display = 'block'; 
            setTimeout(() => document.getElementById('profile-view').style.opacity = '1', 50); 
        }, 300);
    }

    function closeProfile() {
        if(!isMuted) bgmAudio.volume = 1.0;
        document.getElementById('profile-view').style.opacity = '0';
        setTimeout(() => { document.getElementById('profile-view').style.display = 'none'; document.getElementById('main-view').style.display = 'block'; setTimeout(() => document.getElementById('main-view').style.opacity = '1', 50); }, 300);
    }
    
    // IPK Logic
    const ipkSchedule = { 2: new Date('2026-07-05'), 3: new Date('2027-01-24'), 4: new Date('2027-07-04'), 5: new Date('2028-01-23'), 6: new Date('2028-07-09') };
    let editingSem = 0;

    // --- FUNGSI FIX TOMBOL TUTUP IPK ---
    
    // 1. Fungsi Tutup Modal (Pastikan ini ada di Global Scope)
    function closeIPKModal() { 
        console.log("Tombol Tutup Diklik"); // Debugging
        document.getElementById('ipkModal').classList.remove('active'); 
    }

    // 2. Update Fungsi Open IPK Modal (Opsional: Memaksa Event Listener)
    function openIPKModal() {
        if (!currentProfile) return;
        const modal = document.getElementById('ipkModal');
        const listContainer = document.getElementById('semesterList');
        document.getElementById('ipk-nama-mhs').innerText = currentProfile.name;
        listContainer.innerHTML = "";
        const today = new Date();

        for (let i = 1; i <= 6; i++) {
            let nilai = currentProfile[`ipk${i}`] ? currentProfile[`ipk${i}`] : "0.00";
            // Cek properti legacy ipk1 jika belum ada di format baru
            if (i === 1 && !currentProfile[`ipk${i}`] && currentProfile.ipk1) {
                nilai = currentProfile.ipk1;
            }
            
            let hasScore = parseFloat(nilai) > 0;
            let editButtonHtml = ""; 
            let canEdit = true;

            if (hasScore) canEdit = false;
            if (i > 1 && today < ipkSchedule[i]) canEdit = false;

            if (canEdit) { 
                editButtonHtml = `<button class="ipk-edit-btn" onclick="openIpkInputModal(${i})"><i class="fas fa-pencil-alt"></i></button>`; 
            }
            
            const row = document.createElement('div');
            row.className = `semester-row ${hasScore ? 'has-score' : ''}`;
            row.innerHTML = `<span>Semester ${i}</span><span>${nilai}${editButtonHtml}</span>`;
            listContainer.appendChild(row);
        }
        
        // FIX TAMBAHAN: Pastikan tombol tutup memiliki event listener yang benar setiap kali modal dibuka
        const closeBtn = modal.querySelector('.close-ipk');
        if(closeBtn) {
            closeBtn.onclick = closeIPKModal;
        }

        modal.classList.add('active');
    }

    function openIpkInputModal(sem) { editingSem = sem; document.getElementById('modern-ipk-input').value = ""; document.getElementById('ipkModal').classList.remove('active'); document.getElementById('ipkInputModal').classList.add('active'); }
    function closeIpkInputModal() { document.getElementById('ipkInputModal').classList.remove('active'); document.getElementById('ipkModal').classList.add('active'); }
    
    async function confirmIPKInput() {
        const input = document.getElementById('modern-ipk-input');
        const val = parseFloat(input.value);
        if (isNaN(val) || val < 1.00 || val > 4.00) { 
            showNotification("Nilai tidak valid! Masukkan angka antara 1.00 sampai 4.00", "warning"); 
            return; 
        }
        const fixedVal = val.toFixed(2);
        
        input.value = "Menyimpan...";
        input.disabled = true;

        try {
            const response = await fetch('/api/update-ipk', {
                method: 'POST', 
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    nim: currentProfile.nim, 
                    semester: editingSem, 
                    newIpk: fixedVal, 
                    repoOwner: REPO_CONFIG.owner, 
                    repoName: REPO_CONFIG.name 
                })
            });
            
            const result = await response.json();
            
            if (response.ok) {
                currentProfile[`ipk${editingSem}`] = fixedVal;
                
                const targetData = (currentClassLabel === "IF 1") ? dataIF1 : dataIF2;
                const index = targetData.findIndex(s => s.nim === currentProfile.nim);
                if (index !== -1) targetData[index][`ipk${editingSem}`] = fixedVal;

                showNotification(`IPK Semester ${editingSem} berhasil disimpan permanen!`, "success");
                closeIpkInputModal(); 
                openIPKModal();
            } else { 
                throw new Error(result.message); 
            }
        } catch (error) { 
            showNotification("Error: " + error.message, "error"); 
            input.value = ""; 
        } finally {
            input.disabled = false;
            if (input.value === "Menyimpan...") input.value = "";
        }
    }

    // --- VARIABEL COUNTDOWN & SURRENDER ---
    const targetDate = new Date("February 15, 2026 15:00:00").getTime();
    let stegoInterval;

        function openEventModal() {
        const modal = document.getElementById('eventModal');
        const list = document.getElementById('eventListContainer');
        list.innerHTML = "";
        
        // Loop Event (TETAP ADA)
        eventsData.forEach(ev => {
            const item = document.createElement('div');
            
            if (ev.theme === 'fire') { 
                item.className = 'event-item fire-theme'; 
                let surrenderCount = globalStats.stego_surrender_count;

                item.innerHTML = `
                <div class="event-item-content">
                    <div class="event-left">
                        <div class="event-title">${ev.title}</div>
                        <div class="event-prize">Hadiah: ${ev.prize}</div>
                        <div class="surrender-count-badge">
                             ${surrenderCount} Orang Nyerah
                        </div>
                    </div>
                    <div class="event-right">
                        <div class="timer-label">Waktu Tersisa</div>
                        <div id="stego-countdown" class="timer-digit">Loading...</div>
                    </div>
                </div>`;
                
                startStegoCountdown();

            } else { 
                item.className = 'event-item'; 
                item.innerHTML = `<div class="event-title">${ev.title}</div><div class="event-prize">Hadiah: ${ev.prize}</div>`;
            }
            
            if (ev.title === "Steganography") { 
                item.onclick = (e) => { openStegoModal(); }; 
            } else { 
                item.onclick = openChallengeModal; 
            }

            list.appendChild(item);
        });

        // --- BAGIAN YANG DIHAPUS ---
        // (Hapus kode: const clueBtn = document.createElement('button')...)
        // (Hapus kode: list.appendChild(clueBtn)...)
        // ---------------------------
        
        modal.classList.add('active');
    }

    function closeEventModal() { document.getElementById('eventModal').classList.remove('active'); }
    function openChallengeModal() { document.getElementById('eventModal').classList.remove('active'); document.getElementById('challengeModal').classList.add('active'); }
    function closeChallengeModal() { document.getElementById('challengeModal').classList.remove('active'); }

    // --- LOGIKA COUNTDOWN ---
    function startStegoCountdown() {
        if (stegoInterval) clearInterval(stegoInterval);
        
        const updateTimer = () => {
            const now = new Date().getTime();
            const distance = targetDate - now;
            const timerElement = document.getElementById("stego-countdown");

            if (!timerElement) return;

            if (distance < 0) {
                clearInterval(stegoInterval);
                timerElement.innerHTML = "WAKTU HABIS";
                timerElement.style.color = "red";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            timerElement.innerHTML = `${days}h ${hours}j ${minutes}m ${seconds}d`;
        };

        updateTimer();
        stegoInterval = setInterval(updateTimer, 1000);
    }

    // --- LOGIKA MENYERAH ---
    function openSurrenderModal() {
        document.getElementById('stegoModal').classList.remove('active'); 
        document.getElementById('surrenderModal').classList.add('active'); 
    }

    function closeSurrenderModal() {
        document.getElementById('surrenderModal').classList.remove('active');
        document.getElementById('stegoModal').classList.add('active'); 
    }

    async function confirmSurrender() {
        const btn = document.querySelector('.btn-giveup');
        const originalText = btn.innerText;
        btn.innerText = "Menyimpan kekalahanmu...";
        btn.disabled = true;

        try {
            const response = await fetch('/api/update-surrender', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    repoOwner: REPO_CONFIG.owner,
                    repoName: REPO_CONFIG.name
                })
            });

            const result = await response.json();

            if (response.ok) {
                globalStats.stego_surrender_count = result.newCount;
                document.getElementById('surrenderModal').classList.remove('active');
                openEventModal();
                showNotification(`Yahhh cupu...  Total ${result.newCount} orang nyerah!`, "warning");
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            showNotification("Gagal memproses penyerahan: " + error.message, "error");
            document.getElementById('surrenderModal').classList.remove('active');
            document.getElementById('stegoModal').classList.add('active'); 
        } finally {
            btn.innerText = originalText;
            btn.disabled = false;
        }
    }

    // --- LOGIKA CUSTOM DATE PICKER (BARU) ---
    
    let selectedDobValue = ""; // Variabel penyimpan hasil akhir
    let tempDate = { d: null, m: null, y: null };
    const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];

    function initEditDOB() {
        if (localStorage.getItem(`dob_edited_${currentProfile.nim}`) === "true") { 
            showNotification("Tanggal Lahir di Profil ini sudah pernah diubah", "warning"); 
            return; 
        }
        
        // Reset Data & UI
        tempDate = { d: null, m: null, y: null };
        resetPickerUI();
        document.getElementById('datePickerModal').classList.add('active');
    }

    function resetPickerUI() {
        // 1. Generate Tombol Tanggal (1-31)
        const dateGrid = document.getElementById('grid-dates');
        dateGrid.innerHTML = "";
        for (let i = 1; i <= 31; i++) {
            const btn = document.createElement('button');
            btn.className = 'picker-btn';
            btn.innerText = i;
            btn.onclick = () => selectStepDate(i);
            dateGrid.appendChild(btn);
        }

        // 2. Generate Tombol Bulan (Jan-Des)
        const monthGrid = document.getElementById('grid-months');
        monthGrid.innerHTML = "";
        monthNames.forEach((m, index) => {
            const btn = document.createElement('button');
            btn.className = 'picker-btn';
            btn.innerText = m;
            btn.onclick = () => selectStepMonth(index);
            monthGrid.appendChild(btn);
        });

        // 3. Generate Tombol Tahun (2000-2010)
        const yearGrid = document.getElementById('grid-years');
        yearGrid.innerHTML = "";
        for (let i = 2000; i <= 2010; i++) {
            const btn = document.createElement('button');
            btn.className = 'picker-btn';
            btn.innerText = i;
            btn.onclick = () => selectStepYear(i);
            yearGrid.appendChild(btn);
        }

        // Mulai dari Step 1
        showStep('date');
    }

    function showStep(step) {
        // Sembunyikan semua step dulu
        document.getElementById('step-date').style.display = 'none';
        document.getElementById('step-month').style.display = 'none';
        document.getElementById('step-year').style.display = 'none';
        document.getElementById('btn-back-step').style.display = 'none';

        if (step === 'date') {
            document.getElementById('step-date').style.display = 'block';
            document.getElementById('picker-title-step').innerText = "Pilih Tanggal (1-31)";
        } else if (step === 'month') {
            document.getElementById('step-month').style.display = 'block';
            document.getElementById('picker-title-step').innerText = `Tanggal ${tempDate.d} - Pilih Bulan`;
            document.getElementById('btn-back-step').style.display = 'block';
            document.getElementById('btn-back-step').onclick = () => showStep('date');
        } else if (step === 'year') {
            document.getElementById('step-year').style.display = 'block';
            document.getElementById('picker-title-step').innerText = `${tempDate.d} ${monthNames[tempDate.m]} - Pilih Tahun`;
            document.getElementById('btn-back-step').style.display = 'block';
            document.getElementById('btn-back-step').onclick = () => showStep('month');
        }
    }

    function selectStepDate(val) {
        tempDate.d = val;
        showStep('month');
    }

    function selectStepMonth(val) {
        tempDate.m = val; // Index 0-11
        showStep('year');
    }

    function selectStepYear(val) {
        tempDate.y = val;
        processFinalDate();
    }

    function processFinalDate() {
        // Gabungkan jadi format: "20 Mei 2005"
        selectedDobValue = `${tempDate.d} ${monthNames[tempDate.m]} ${tempDate.y}`;
        
        document.getElementById('conf-dob-display').innerText = selectedDobValue;
        document.getElementById('datePickerModal').classList.remove('active');
        document.getElementById('dateConfirmModal').classList.add('active');
    }

    function closeDatePicker() {
        document.getElementById('datePickerModal').classList.remove('active');
    }

    function closeDateConfirm() {
        // Kalau batal konfirmasi, kembali ke picker custom
        document.getElementById('dateConfirmModal').classList.remove('active');
        document.getElementById('datePickerModal').classList.add('active');
    }
    function formatIndoDate(dateString) { const date = new Date(dateString); return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }); }
    function confirmDateSelection() {
        const inputVal = document.getElementById('newDobInput').value;
        if (!inputVal) { showNotification("Pilih tanggal terlebih dahulu!", "warning"); return; }
        selectedDobValue = formatIndoDate(inputVal);
        document.getElementById('conf-dob-display').innerText = selectedDobValue;
        document.getElementById('datePickerModal').classList.remove('active'); document.getElementById('dateConfirmModal').classList.add('active');
    }
    function initVerification() { document.getElementById('dateConfirmModal').classList.remove('active'); document.getElementById('verifyModal').classList.add('active'); document.getElementById('nim-verify-input').value = ""; document.getElementById('nim-verify-input').focus(); }
    function closeVerifyModal() { document.getElementById('verifyModal').classList.remove('active'); document.getElementById('dateConfirmModal').classList.add('active'); }
    function submitVerification() {
        const input = document.getElementById('nim-verify-input').value;
        const correctSuffix = currentProfile.nim.slice(-2);
        if (input === correctSuffix) { finalUpdateDOB(); } else { showNotification("Verifikasi Gagal! 2 Digit terakhir NIM salah.", "error"); }
    }
    async function finalUpdateDOB() {
        const dobElement = document.getElementById('p-dob');
        const originalText = dobElement.innerText;
        document.getElementById('verifyModal').classList.remove('active');
        dobElement.innerHTML = "<em>Menyimpan...</em>";
        try {
            const response = await fetch('/api/update-dob', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nim: currentProfile.nim, newDOB: selectedDobValue, repoOwner: REPO_CONFIG.owner, repoName: REPO_CONFIG.name })
            });
            const result = await response.json();
            if (response.ok) {
                showNotification("Berhasil disimpan! Data di GitHub akan terupdate.", "success");
                localStorage.setItem(`dob_edited_${currentProfile.nim}`, "true");
                const dobIcon = document.getElementById('dob-edit-icon');
                dobIcon.classList.add('faded'); dobIcon.onclick = function() { showNotification("Tanggal Lahir di Profil ini sudah pernah diubah", "warning"); };
                dobElement.innerText = selectedDobValue; currentProfile.dob = selectedDobValue;
                const targetData = (currentClassLabel === "IF 1") ? dataIF1 : dataIF2;
                const index = targetData.findIndex(s => s.nim === currentProfile.nim);
                if (index !== -1) targetData[index].dob = selectedDobValue;
            } else { throw new Error(result.message || "Gagal menyimpan."); }
        } catch (error) { showNotification("Gagal menyimpan: " + error.message, "error"); dobElement.innerText = originalText; }
    }

    // Jodoh Logic
    let matchInterval;
    function cekJodoh() {
        if (!currentProfile) return;
        const closeBtn = document.querySelector('.close-match');
        closeBtn.disabled = true; closeBtn.style.opacity = '0.5'; closeBtn.style.cursor = 'not-allowed';
        let countdownVal = 3; closeBtn.innerText = `Tunggu ${countdownVal}...`;
        const btnInterval = setInterval(() => { countdownVal--; if (countdownVal > 0) { closeBtn.innerText = `Tunggu ${countdownVal}...`; } else { clearInterval(btnInterval); } }, 1000);

        const myGender = currentProfile.gender; const targetGender = myGender === 'L' ? 'P' : 'L';
        let normalPool = allStudents.filter(s => s.gender === targetGender).map(s => ({ type: 'student', ...s }));
        normalPool.push({ type: 'special', subtype: 'kematian', name: "Kematian" });
        normalPool.push({ type: 'special', subtype: 'allah', name: "Hanya Allah Yang Tahu" });
        normalPool.push({ type: 'special', subtype: 'ceo', name: "CEO" });

        let animationCandidates = [...normalPool]; let finalResult = null;
        if (currentProfile.name === "Fikri Julianda Laksono") { finalResult = { type: 'student', name: "Aisyah Nur Syifa", gender: "P" }; }
        else if (currentProfile.name === "Aisyah Nur Syifa") { finalResult = { type: 'student', name: "Fikri Julianda Laksono", gender: "L" }; }
        else if (currentProfile.name.includes("Leni")) {
            const rng = Math.random();
            if (rng < 0.7) { finalResult = { type: 'student', name: "Se-hun", gender: "L" }; } 
            else { finalResult = { type: 'special', subtype: 'halu', name: "Dih Ngarepin Siapa Sih, Halu!" }; }
        }
        else if (currentProfile.name === "Amri Rahman") {
            const rng = Math.random();
            if (rng < 0.7) { 
                const boyPool = allStudents.filter(s => s.gender === 'L' && s.name !== "Gilang Aidil Pratama" && s.name !== "Amri Rahman").map(s => ({ type: 'student', ...s }));
                animationCandidates = boyPool; finalResult = boyPool[Math.floor(Math.random() * boyPool.length)];
            } else {
                const girlPool = allStudents.filter(s => s.gender === 'P').map(s => ({ type: 'student', ...s }));
                animationCandidates = girlPool; finalResult = girlPool[Math.floor(Math.random() * girlPool.length)];
            }
        }
        if (!finalResult) {
            let fullPool = [...animationCandidates];
            fullPool.push({ type: 'special', subtype: 'halu', name: "Dih Ngarepin Siapa Sih, Halu!" });
            if (myGender === 'L') { fullPool.push({ type: 'special', subtype: 'ukthi', name: "Ukthi Yalil Yalili" }); } 
            else { fullPool.push({ type: 'special', subtype: 'korea', name: "Cowo Korea" }); fullPool.push({ type: 'special', subtype: 'cina', name: "Cowo Cina" }); }
            animationCandidates = fullPool; finalResult = fullPool[Math.floor(Math.random() * fullPool.length)];
        }

        const modal = document.getElementById('jodohModal');
        const searchUI = document.getElementById('searching-ui');
        const finalUI = document.getElementById('final-couple-ui');
        const nameDisplay = document.getElementById('match-name-display');
        searchUI.style.display = 'block'; finalUI.style.display = 'none'; modal.classList.add('active');
        if (audioCtx.state === 'suspended') audioCtx.resume();

        matchInterval = setInterval(() => {
            const r = animationCandidates[Math.floor(Math.random() * animationCandidates.length)];
            nameDisplay.innerText = r.subtype === 'ceo' ? CEO_NAMES[Math.floor(Math.random()*CEO_NAMES.length)] : r.name;
            nameDisplay.style.color = "#ccc"; playTick();
        }, 100);

        setTimeout(() => {
            clearInterval(matchInterval); clearInterval(btnInterval);
            closeBtn.innerText = "Tutup"; closeBtn.disabled = false; closeBtn.style.opacity = '1'; closeBtn.style.cursor = 'pointer';
            let result = finalResult;
            searchUI.style.display = 'none'; finalUI.style.display = 'block'; finalUI.innerHTML = "";
            bgmAudio.pause();
            let htmlContent = "";

            if (result.type === 'student') {
                let content = getStudentCoupleContent();
                if (currentProfile.gender === 'L' && currentProfile.name !== "Fikri Julianda Laksono" && result.name === "Aisyah Nur Syifa") { content.text = "Mau Dihantam Fikri Lu?"; content.gif = "https://media.tenor.com/NBexh7vX1rAAAAAi/slap-hand.gif"; }
                else if (currentProfile.gender === 'P' && currentProfile.name !== "Aisyah Nur Syifa" && result.name === "Fikri Julianda Laksono") { content.text = "Mau Ditampar Syifa Lu?"; content.gif = "https://media.tenor.com/NBexh7vX1rAAAAAi/slap-hand.gif"; }
                htmlContent = `<div class="couple-container"><div class="c-name-user">${currentProfile.name}</div><div class="c-heart"><i class="fas fa-heart"></i></div><div class="c-name-partner">${result.name}</div></div><div class="couple-sub">${content.text}</div><img src="${content.gif}" class="couple-gif" alt="Funny Gif" loading="lazy">`;
                playRandomJodohSong(); 
            } else {
                let title = result.name; let sub = ""; let soundToPlay = "";
                switch(result.subtype) {
                    case 'kematian': title = "KEMATIAN"; sub = "Perbaiki Ibadahmu, Kematian Gak Ada Yang Tahu Kapan"; soundToPlay = S_MATI; break;
                    case 'allah': sub = "Sempurnakan, Perbaiki, Dan Pantaskan Agar Allah Berikan Yang Terbaik"; soundToPlay = S_ISLAMI; break;
                    case 'ceo': title = CEO_NAMES[Math.floor(Math.random() * CEO_NAMES.length)]; sub = "Korban Drachin"; soundToPlay = S_FUNNY; htmlContent = `<div class="couple-container"><div class="c-name-user">${currentProfile.name}</div><div class="c-heart"><i class="fas fa-heart"></i></div><div class="c-name-partner">${title}</div></div><div class="couple-sub">${sub}</div>`; break;
                    case 'halu': sub = "Dia Udah Jadi Milik Yang Lain :)"; soundToPlay = S_SAD; break;
                    case 'ukthi': sub = "Perbaiki Dirimu Agar Pantas Dengannya Atau Akan Allah Jauhkan"; soundToPlay = S_YALILI; break;
                    case 'korea': case 'cina': sub = "Ah Masa Sih, Emang Dia Mau Ya?"; soundToPlay = S_FUNNY; break;
                }
                if (result.subtype !== 'ceo') { htmlContent = `<div class="special-title">${title}</div><div class="couple-sub">${sub}</div>`; }
                jodohAudio.src = soundToPlay; jodohAudio.play(); jodohAudio.onended = null; 
            }
            finalUI.innerHTML = htmlContent;
        }, 3000);
    }
    function closeJodoh() { document.getElementById('jodohModal').classList.remove('active'); clearInterval(matchInterval); jodohAudio.pause(); jodohAudio.currentTime = 0; bgmAudio.play(); if(!isMuted) bgmAudio.volume = 0.2; }

    function copyNIM() { navigator.clipboard.writeText(document.getElementById('p-nim').innerText).then(() => { document.getElementById('copy-tooltip').classList.add('show'); setTimeout(() => document.getElementById('copy-tooltip').classList.remove('show'), 1500); }); }
    function setMobileList() { document.getElementById('cardGrid').classList.remove('mobile-grid-active'); document.getElementById('btnList').classList.add('active'); document.getElementById('btnGrid').classList.remove('active'); localStorage.setItem('mobileLayout', 'list'); }
    function setMobileGrid() { document.getElementById('cardGrid').classList.add('mobile-grid-active'); document.getElementById('btnGrid').classList.add('active'); document.getElementById('btnList').classList.remove('active'); localStorage.setItem('mobileLayout', 'grid'); }
    function toggleTheme() { document.body.classList.toggle('dark-mode'); localStorage.setItem('theme', document.body.classList.contains('dark-mode')?'dark':'light'); document.querySelector('#themeToggle i').className = document.body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon'; if(document.body.classList.contains('dark-mode')) { meteorLoop(); } }
    function getInitials(n) { let p=n.split(" "); return p.length>1?(p[0][0]+p[1][0]).toUpperCase():p[0].substring(0,2).toUpperCase(); }
    
    let searchTimeout;
    function filterNames() { 
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            const v=document.getElementById("searchInput").value.toUpperCase(); 
            const c=document.getElementById("cardGrid").getElementsByClassName("card"); 
            for(let i=0;i<c.length;i++){ 
                const t=c[i].textContent||c[i].innerText; 
                c[i].classList.toggle('hidden-card', t.toUpperCase().indexOf(v) === -1);
            } 
        }, 150); 
    }

    // Steganography Logic
    const SECRET_HASH_CODE = "438201956"; 
    const SETUP_MODE = false; 

    function generateSafeHash(str) {
        let hash = 0; if (str.length === 0) return hash.toString();
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i); hash = ((hash << 5) - hash) + char; hash = hash & hash;
        } return hash.toString();
    }

    function openStegoModal() {
        document.getElementById('eventModal').classList.remove('active'); document.getElementById('stegoModal').classList.add('active');
        document.getElementById('stegoAnswerInput').value = "";
        if(SETUP_MODE) { document.getElementById('stegoAnswerInput').placeholder = "[MODE SETUP AKTIF] Ketik Jawaban Benar..."; }
    }
    function closeStegoModal() { document.getElementById('stegoModal').classList.remove('active'); document.getElementById('eventModal').classList.add('active'); }
    function checkStegoAnswer() {
        const input = document.getElementById('stegoAnswerInput').value;
        const cleanInput = input.trim().toUpperCase(); 
        const userHash = generateSafeHash(cleanInput);
        if (SETUP_MODE) {
            console.log("JAWABAN:", cleanInput); console.log("KODE HASH:", userHash);
            alert(`KODE HASH UNTUK "${cleanInput}" ADALAH:\n\n${userHash}\n\nSalin angka tersebut dan masukkan ke const SECRET_HASH_CODE di codingan, lalu ubah SETUP_MODE jadi false.`);
            return; 
        }
        if (userHash === SECRET_HASH_CODE) {
            document.getElementById('stegoModal').classList.remove('active'); document.getElementById('stegoSuccessModal').classList.add('active');
        } else {
            showNotification("Jawaban Salah! Coba cari petunjuk lagi.", "error");
            document.getElementById('stegoAnswerInput').style.border = "2px solid red";
            setTimeout(() => { document.getElementById('stegoAnswerInput').style.border = "none"; }, 1000);
        }
    }
    function openStegoImage() { 
        document.getElementById('stegoImageModal').classList.add('active'); 
    }
    
    function closeStegoImage(e) { 
        // Hanya tutup modal jika yang diklik adalah background hitam (overlay-nya)
        // Mencegah modal tertutup saat mengklik gambar atau tombol
        if (e && e.target.id !== 'stegoImageModal') return;
        document.getElementById('stegoImageModal').classList.remove('active'); 
    }

    function openImageTab(e, url) {
        if (e) e.stopPropagation(); // Mencegah klik tembus ke background penutup
        window.open(url, '_blank');
    }

    async function downloadImage(e, url) {
        if (e) e.stopPropagation(); // Mencegah klik tembus ke background penutup
        
        showNotification("Mendownload gambar...", "info");
        try {
            // Fetch gambar sebagai Blob (data biner) agar bisa dipaksa download
            const response = await fetch(url);
            const blob = await response.blob();
            const blobUrl = URL.createObjectURL(blob);
            
            // Buat elemen link (a) sementara untuk memicu download
            const link = document.createElement('a');
            link.href = blobUrl;
            link.download = 'Clue_Steganography.png'; // Nama file saat disimpan
            document.body.appendChild(link);
            link.click();
            
            // Bersihkan sisa link dan blob
            document.body.removeChild(link);
            URL.revokeObjectURL(blobUrl);
            
            showNotification("Gambar berhasil didownload!", "success");
        } catch (error) {
            // Jika server gambar menolak fetch (masalah CORS), beri instruksi manual
            showNotification("Gagal mendownload otomatis. Klik 'Buka Gambar' lalu simpan manual.", "error");
        }
    }
    
    // --- FITUR EASTER EGG (KONAMI CODE) ---
    // Sequence: Up, Up, Down, Down, Left, Right, Left, Right, B, A
    const konamiCode = [
        "ArrowUp", "ArrowUp", "ArrowDown", "ArrowDown", 
        "ArrowLeft", "ArrowRight", "ArrowLeft", "ArrowRight", 
        "b", "a"
    ];
    let konamiIndex = 0;

    document.addEventListener('keydown', (e) => {
        // Cek apakah tombol yang ditekan sesuai urutan
        if (e.key.toLowerCase() === konamiCode[konamiIndex].toLowerCase() || e.key === konamiCode[konamiIndex]) {
            konamiIndex++;
            
            // Jika urutan lengkap
            if (konamiIndex === konamiCode.length) {
                activateKonamiMode();
                konamiIndex = 0; // Reset
            }
        } else {
            konamiIndex = 0; // Salah tombol, ulang dari awal
        }
    });

    function activateKonamiMode() {
        showNotification("KONAMI CODE ACTIVATED! MODUS PARTY DIMULAI!", "party");

        // 1. Ubah Body jadi Rainbow
        document.body.classList.add('konami-active');

        // 2. Putar Lagu Party (Ganti lagu saat ini)
        // Lagu contoh: Jedag Jedug atau Meme Song
        // Saya pakai link mp3 lucu (Running in the 90s atau sejenisnya)
        const funnySong = "https://od.lk/s/NjhfMTYyNzYyNDIwXw/Alur%20Cerita%20FB%20CUT.mp3"; // Menggunakan lagu S_FUNNY yg sudah ada
        
        bgmAudio.src = funnySong;
        bgmAudio.volume = 1.0;
        bgmAudio.loop = true;
        bgmAudio.play();
        updateNPUI("MODUS PARTY AKTIF ");

        // 3. Ubah Semua Kartu & Avatar
        const cards = document.querySelectorAll('.card');
        const funnyGif = "https://media.tenor.com/5EYt5mnIMvwAAAAi/silly-cat-dance.gif"; // Bisa ganti GIF kucing

        cards.forEach(card => {
            // Tambah efek putar
            card.classList.add('konami-spin');
            
            // Ganti Avatar jadi GIF
            const avatar = card.querySelector('.avatar');
            if (avatar) {
                avatar.innerHTML = `<img src="https://media.tenor.com/5EYt5mnIMvwAAAAi/silly-cat-dance.gif" class="konami-avatar-img">`;
                avatar.style.background = "transparent";
                avatar.style.boxShadow = "none";
            }
        });

        // 4. Ubah Judul
        document.querySelector('h1').innerText = "KELAS INFORMATIKA PARTY!!";
    }
    
// --- KONFIGURASI CLUE (ISI KATA-KATANYA DI SINI) ---
    const STEGO_CLUES = [
        "Clue 1: Coba perhatikan baik-baik gambar pantai tersebut, coba zoom dan temukan sesuatu di gambarnya.",
        "Clue 2: Jika sudah menemukan sesuatu di gambar pantai, akali agar bisa digunakan.",
        "Clue 3: Apa yang kamu baca disitu hanyalah pengalihan dan tidak berhubungan apa-apa dengan jawaban.",
        "Clue 4: Judul event mungkin bisa membantumu"
    ];

    // --- LOGIKA CLUE SYSTEM ---

    function openClueSelection() {
        // Tutup modal event utama, buka modal pemilihan clue
        document.getElementById('eventModal').classList.remove('active');
        document.getElementById('clueSelectionModal').classList.add('active');
    }

    function closeClueSelection() {
        // Kembali ke modal event utama
        document.getElementById('clueSelectionModal').classList.remove('active');
        document.getElementById('eventModal').classList.add('active');
    }

    function openStegoClueList() {
        const container = document.getElementById('clue-container-list');
        container.innerHTML = ""; // Bersihkan isi lama

        // Render Clue dari Array
        STEGO_CLUES.forEach((text, index) => {
            const div = document.createElement('div');
            div.className = 'clue-item';
            div.innerHTML = `<span class="clue-number">Petunjuk #${index + 1}</span>${text}`;
            container.appendChild(div);
        });

        document.getElementById('clueSelectionModal').classList.remove('active');
        document.getElementById('clueListModal').classList.add('active');
    }

    function backToClueSelection() {
        document.getElementById('clueListModal').classList.remove('active');
        document.getElementById('clueSelectionModal').classList.add('active');
    }
</script>
</body>
</html>
